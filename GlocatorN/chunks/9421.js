"use strict";(self.webpackChunkmomraGisCore=self.webpackChunkmomraGisCore||[]).push([[9421],{67262:(t,e,n)=>{n.d(e,{d:()=>r});var o=n(19431);function r(t,e,n){var r;const l=t.byteLength/(4*e),f=new Uint32Array(t,0,l*e);let u=new Uint32Array(l);const g=null!=(r=null==n?void 0:n.minReduction)?r:0,d=(null==n?void 0:n.originalIndices)||null,p=d?d.length:0,h=(null==n?void 0:n.componentOffsets)||null;let m=0;if(h)for(let t=0;t<h.length-1;t++){const e=h[t+1]-h[t];e>m&&(m=e)}else m=l;const w=Math.floor(1.1*m)+1;(null==a||a.length<2*w)&&(a=new Uint32Array((0,o.Sf)(2*w)));for(let t=0;t<2*w;t++)a[t]=0;let v=0;const y=!!h&&!!d,A=y?p:l,b=y?new Uint32Array(p):null,I=1.96;let S=0!==g?Math.ceil(4*I*I/(g*g)*g*(1-g)):A,N=1,U=h?h[1]:A;for(let t=0;t<A;t++){if(t===S){const e=1-v/t;if(e+I*Math.sqrt(e*(1-e)/t)<g)return null;S*=2}if(t===U){for(let t=0;t<2*w;t++)a[t]=0;if(d)for(let t=h[N-1];t<h[N];t++)b[t]=u[d[t]];U=h[++N]}const n=y?d[t]:t,o=n*e,r=c(f,o,e);let s=r%w,l=v;for(;0!==a[2*s+1];){if(a[2*s]===r){const t=a[2*s+1]-1;if(i(f,o,t*e,e)){l=u[t];break}}s++,s>=w&&(s-=w)}l===v&&(a[2*s]=r,a[2*s+1]=n+1,v++),u[n]=l}if(0!==g&&1-v/l<g)return null;if(y){for(let t=h[N-1];t<b.length;t++)b[t]=u[d[t]];u=b}const E=new Uint32Array(e*v);v=0;for(let t=0;t<A;t++)u[t]===v&&(s(f,(y?d[t]:t)*e,E,v*e,e),v++);if(d&&!y){const t=new Uint32Array(p);for(let e=0;e<t.length;e++)t[e]=u[d[e]];u=t}return{buffer:E.buffer,indices:u,uniqueCount:v}}function i(t,e,n,o){for(let r=0;r<o;r++)if(t[e+r]!==t[n+r])return!1;return!0}function s(t,e,n,o,r){for(let i=0;i<r;i++)n[o+i]=t[e+i]}function c(t,e,n){let o=0;for(let r=0;r<n;r++)o=t[e+r]+o|0,o=o+(o<<11)+(o>>>2)|0;return o>>>0}let a=null},95397:(t,e,n)=>{function o(t,e=0){const n=t.stride;return t.fieldNames.filter((e=>{const n=t.fields.get(e).optional;return!(n&&n.glPadding)})).map((o=>{const i=t.fields.get(o),s=i.constructor.ElementCount,c=r(i.constructor.ElementType),a=i.offset,l=!(!i.optional||!i.optional.glNormalized);return{name:o,stride:n,count:s,type:c,offset:a,normalized:l,divisor:e}}))}function r(t){const e=i[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}n.d(e,{K:()=>o});const i={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},39421:(t,e,n)=>{n.r(e),n.d(e,{work:()=>G,wrappedWork:()=>$});var o=n(67262);function r(t,e,n){const o=e/3,r=new Uint32Array(n+1),i=new Uint32Array(n+1),s=(t,e)=>{t<e?r[t+1]++:i[e+1]++};for(let e=0;e<o;e++){const n=t[3*e],o=t[3*e+1],r=t[3*e+2];s(n,o),s(o,r),s(r,n)}let c=0,a=0;for(let t=0;t<n;t++){const e=r[t+1],n=i[t+1];r[t+1]=c,i[t+1]=a,c+=e,a+=n}const l=new Uint32Array(6*o),f=r[n],u=(t,e,n)=>{if(t<e){const o=r[t+1]++;l[2*o]=e,l[2*o+1]=n}else{const o=i[e+1]++;l[2*f+2*o]=t,l[2*f+2*o+1]=n}};for(let e=0;e<o;e++){const n=t[3*e],o=t[3*e+1],r=t[3*e+2];u(n,o,e),u(o,r,e),u(r,n,e)}const g=(t,e)=>{const n=2*t,o=e-t;for(let t=1;t<o;t++){const e=l[n+2*t],o=l[n+2*t+1];let r=t-1;for(;r>=0&&l[n+2*r]>e;r--)l[n+2*r+2]=l[n+2*r],l[n+2*r+3]=l[n+2*r+1];l[n+2*r+2]=e,l[n+2*r+3]=o}};for(let t=0;t<n;t++)g(r[t],r[t+1]),g(f+i[t],f+i[t+1]);const d=new Int32Array(3*o),p=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,h=(t,e)=>{const n=p(t,e);d[3*e+n]=-1},m=(t,e,n,o)=>{const r=p(t,e);d[3*e+r]=o;const i=p(n,o);d[3*o+i]=e};for(let t=0;t<n;t++){let e=r[t];const n=r[t+1];let o=i[t];const s=i[t+1];for(;e<n&&o<s;){const n=l[2*e],r=l[2*f+2*o];n===r?(m(t,l[2*e+1],r,l[2*f+2*o+1]),e++,o++):n<r?(h(t,l[2*e+1]),e++):(h(r,l[2*f+2*o+1]),o++)}for(;e<n;)h(t,l[2*e+1]),e++;for(;o<s;)h(l[2*f+2*o],l[2*f+2*o+1]),o++}return d}var i=n(81936),s=n(44685);function c(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:a(t.layout)}}function a(t){const e=new Array;return t.fields.forEach(((t,n)=>{const o={...t,constructor:f(t.constructor)};e.push([n,o])})),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}const l=[i.ly,i.Eu,i.ct,i.ek,i.gK,i.bj,i.oS,i.q6,i.fP,i.Cd,i.ey,i.O1,i.D_,i.xA,i.ne,i.mc,i.av,i.TS,i.mw,i.v6,i.Nu,i.qt,i.G5,i.hu,i.Hz,i.Vs,i.P_,i.ir,i.o7,i.or,i.n1,i.zO,i.Jj,i.wA,i.PP,i.TN];function f(t){return`${t.ElementType}_${t.ElementCount}`}const u=new Map;l.forEach((t=>u.set(f(t),t)));var g=n(95397);const d=(0,s.U$)().vec3f("position").u16("componentIndex").u16("u16padding"),p=(0,s.U$)().vec2u8("sideness"),h=((0,g.K)(p),(0,s.U$)().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0})),m=h.clone().vec3f("normal"),w=h.clone().vec3f("normalA").vec3f("normalB");new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]]);var v=n(4157),y=n(6766),A=n(8909);class b{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?E:U}write(t,e,n){const o=this.edgeHashFunction(n);M.seed=o;const r=M.getIntRange(0,255),i=M.getIntRange(0,this.settings.variants-1),s=M.getFloat(),c=255*(.5*function(t,e){const n=t<0?-1:1;return Math.abs(t)**1.2*n}(-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7))+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,r),t.variantStroke.set(e,i),t.variantExtension.set(e,c)}trim(t,e){return t.slice(0,e)}}const I=new Float32Array(6),S=new Uint32Array(I.buffer),N=new Uint32Array(1);function U(t){const e=I;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],N[0]=5381;for(let t=0;t<S.length;t++)N[0]=31*N[0]+S[t];return N[0]}function E(t){const e=I;e[0]=V(t.position0[0]),e[1]=V(t.position0[1]),e[2]=V(t.position0[2]),e[3]=V(t.position1[0]),e[4]=V(t.position1[1]),e[5]=V(t.position1[2]),N[0]=5381;for(let t=0;t<S.length;t++)N[0]=31*N[0]+S[t];return N[0]}function V(t){return Math.round(1e4*t)/1e4}class L{constructor(){this.commonWriter=new b}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return m.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),(0,y.b)(x,n.faceNormal0,n.faceNormal1),(0,y.n)(x,x),t.normal.setVec(e,x)}trim(t,e){return this.commonWriter.trim(t,e)}}L.Layout=m,L.glLayout=(0,g.K)(m,1);class k{constructor(){this.commonWriter=new b}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return w.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),t.normalA.setVec(e,n.faceNormal0),t.normalB.setVec(e,n.faceNormal1)}trim(t,e){return this.commonWriter.trim(t,e)}}k.Layout=w,k.glLayout=(0,g.K)(w,1);const x=(0,A.c)(),M=new v.Z;var D=n(7753),P=n(19431),W=n(86098);const B=-1;function C(t,e){return t.cosAngle<e}function F(t,e){return t.cosAngle>e}function T(t,e){const n=(0,P.ZF)(t.cosAngle),o=O.fwd,r=O.ortho;return(0,y.r)(o,t.position1,t.position0),n*((0,y.d)((0,y.c)(r,t.faceNormal0,t.faceNormal1),o)>0?-1:1)>e}function z(t){const e=t.faces.length/3,n=t.vertices.position,o=t.faces,r=q.v0,i=q.v1,s=q.v2,c=new Float32Array(3*e);for(let t=0;t<e;t++){const e=o[3*t+0],a=o[3*t+1],l=o[3*t+2];n.getVec(e,r),n.getVec(a,i),n.getVec(l,s),(0,y.f)(i,i,r),(0,y.f)(s,s,r),(0,y.c)(r,i,s),(0,y.n)(r,r),c[3*t+0]=r[0],c[3*t+1]=r[1],c[3*t+2]=r[2]}return c}const O={edge:{position0:(0,A.c)(),position1:(0,A.c)(),faceNormal0:(0,A.c)(),faceNormal1:(0,A.c)(),componentIndex:0,cosAngle:0},ortho:(0,A.c)(),fwd:(0,A.c)()},q={v0:(0,A.c)(),v1:(0,A.c)(),v2:(0,A.c)()},K={anglePlanar:4,angleSignificantEdge:35};async function $(t){const e=function(t){return{data:d.createView(t.dataBuffer),indices:"Uint32Array"===t.indicesType?new Uint32Array(t.indicesBuffer):"Uint16Array"===t.indicesType?new Uint16Array(t.indicesBuffer):void 0,indicesLength:t.indicesLength,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate}}(t),n=G(e),o=[e.data.buffer];return{result:H(n,o),transferList:o}}function G(t){const e=R(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return _.updateSettings(t.writerSettings),j.updateSettings(t.writerSettings),function(t,e,n,o=K){const r=t.vertices.position,i=t.vertices.componentIndex,s=(0,P.Vl)(o.anglePlanar),c=(0,P.Vl)(o.angleSignificantEdge),a=Math.cos(c),l=Math.cos(s),f=O.edge,u=f.position0,g=f.position1,d=f.faceNormal0,p=f.faceNormal1,h=z(t),m=function(t){const e=t.faces.length/3,n=t.faces,o=t.neighbors;let r=0;for(let t=0;t<e;t++){const e=o[3*t+0],i=o[3*t+1],s=o[3*t+2],c=n[3*t+0],a=n[3*t+1],l=n[3*t+2];r+=e===B||c<a?1:0,r+=i===B||a<l?1:0,r+=s===B||l<c?1:0}const i=new Int32Array(4*r);let s=0;for(let t=0;t<e;t++){const e=o[3*t+0],r=o[3*t+1],c=o[3*t+2],a=n[3*t+0],l=n[3*t+1],f=n[3*t+2];(e===B||a<l)&&(i[s++]=a,i[s++]=l,i[s++]=t,i[s++]=e),(r===B||l<f)&&(i[s++]=l,i[s++]=f,i[s++]=t,i[s++]=r),(c===B||f<a)&&(i[s++]=f,i[s++]=a,i[s++]=t,i[s++]=c)}return i}(t),w=m.length/4,v=e.allocate(w);let A=0;const b=w,I=n.allocate(b);let S=0,N=0,U=0;const E=(0,D.w6)(0,w),V=new Float32Array(w);(0,W.Ed)(V,((t,e,n)=>{r.getVec(m[4*e+0],u),r.getVec(m[4*e+1],g),n[e]=(0,y.i)(u,g)})),E.sort(((t,e)=>V[e]-V[t]));const L=new Array,k=new Array;for(let t=0;t<w;t++){const o=E[t],c=V[o],w=m[4*o+0],b=m[4*o+1],x=m[4*o+2],M=m[4*o+3],D=M===B;if(r.getVec(w,u),r.getVec(b,g),D)(0,y.s)(d,h[3*x+0],h[3*x+1],h[3*x+2]),(0,y.g)(p,d),f.componentIndex=i.get(w),f.cosAngle=(0,y.d)(d,p);else{if((0,y.s)(d,h[3*x+0],h[3*x+1],h[3*x+2]),(0,y.s)(p,h[3*M+0],h[3*M+1],h[3*M+2]),f.componentIndex=i.get(w),f.cosAngle=(0,y.d)(d,p),F(f,l))continue;f.cosAngle<-.9999&&(0,y.g)(p,d)}N+=c,U++,D||C(f,a)?(e.write(v,A++,f),L.push(c)):T(f,s)&&(n.write(I,S++,f),k.push(c))}const x=new Float32Array(L.reverse()),M=new Float32Array(k.reverse());return{regular:{instancesData:e.trim(v,A),lodInfo:{lengths:x}},silhouette:{instancesData:n.trim(I,S),lodInfo:{lengths:M}},averageEdgeLength:N/U}}(e,_,j)}function H(t,e){return e.push(t.regular.lodInfo.lengths.buffer),e.push(t.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:c(t.regular.instancesData,e),lodInfo:{lengths:t.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:c(t.silhouette.instancesData,e),lodInfo:{lengths:t.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:t.averageEdgeLength}}function R(t,e,n,i){if(e)return{faces:n,facesLength:i,neighbors:r(n,i,t.count),vertices:t};const s=(0,o.d)(t.buffer,t.stride/4,{originalIndices:n,originalIndicesLength:i}),c=r(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:c,vertices:d.createView(s.buffer)}}const _=new L,j=new k}}]);
//# sourceMappingURL=9421.js.map