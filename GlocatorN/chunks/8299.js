"use strict";(self.webpackChunkmomraGisCore=self.webpackChunkmomraGisCore||[]).push([[8299],{18486:(t,e,n)=>{n.d(e,{vF:()=>Z,_D:()=>m,Qp:()=>A,P_:()=>S,ut:()=>b,Hq:()=>P,zD:()=>p,tB:()=>w,nF:()=>g,VO:()=>d,Mk:()=>h,kZ:()=>C,kr:()=>F}),n(91957);var r=n(70375),a=n(61681),o=n(17321),i=n(89696),s=n(91772),l=n(53446);const c=5e-4;function h(t,e,n){return!(0,i.Up)(t,e,n)}function u(t,e,n){const a=h(t,e,n);if(a&&!(0,i.kR)())throw new r.Z("rasterprojectionhelper-project","projection engine is not loaded");return a}const f=function(t,e,n){const r=(t[0]+t[4]+t[4*e.cols]+t[4*e.cols+4])/4,a=(t[1]+t[5]+t[4*e.rows+1]+t[4*e.rows+5])/4,o=(t[4*e.cols]-t[0]+t[4*e.cols+4]-t[4])/n[0]*.5,i=(t[4*e.cols+1]-t[1]+t[4*e.cols+5]-t[5])/n[1]*.5;return[0===o||isNaN(o)?0:Math.abs(r-t[2*e.rows+2])/Math.abs(o),0===i||isNaN(i)?0:Math.abs(a-t[2*e.rows+3])/Math.abs(i)]},x={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244};async function p(){if((0,i.kR)())return null;await(0,i.zD)()}function m(t,e,n){return u(t.spatialReference,e)?n?(0,i.rS)(e,t.spatialReference,t):(0,i.rS)(t.spatialReference,e,t):null}function d(t,e,n,r=null){if(t.spatialReference.equals(e))return t;u(t.spatialReference,e,r);const o=n.center,l=new s.Z({xmin:o.x-t.x/2,xmax:o.x+t.x/2,ymin:o.y-t.y/2,ymax:o.y+t.y/2,spatialReference:t.spatialReference}),c=(0,i.iV)(l,e,r);return(0,a.Wi)(c)?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function y(t,e=.01){return(0,o.c9)(t)?e/(0,o.c9)(t):0}function g(t,e,n=null,r=!0){const a=t.spatialReference;if(a.equals(e))return t;u(a,e,n);const o=(0,i.iV)(t,e,n);if(r&&e.isGeographic){const[e,n]=v(a,!0),r=y(a);r&&null!=e&&null!=n&&(Math.abs(t.x-e)<r&&Math.abs(180-o.x)<c?o.x-=360:Math.abs(t.x-n)<r&&Math.abs(180+o.x)<c&&(o.x+=360))}return o}function M(t){const e=b(t[0].spatialReference);if(t.length<2||!(0,a.pC)(e))return t[0];let{xmin:n,xmax:r,ymin:o,ymax:i}=t[0];for(let n=1;n<t.length;n++){const a=t[n];r=a.xmax+e*n,o=Math.min(o,a.ymin),i=Math.max(i,a.ymax)}return new s.Z({xmin:n,xmax:r,ymin:o,ymax:i,spatialReference:t[0].spatialReference})}function w(t,e,n=null,r=!0){if(t.spatialReference.equals(e))return t;const o=P(t),i=b(t.spatialReference,!0);return(0,a.pC)(i)&&0!==o?M(t.clone().normalize().map((t=>k(t,e,n,r)))):k(t,e,n,r)}function k(t,e,n=null,r=!0){const a=t.spatialReference;if(a.equals(e))return t;u(a,e,n);const o=(0,i.iV)(t,e,n);let[s,h]=v(a,!0);if(o&&r&&a.isWebMercator&&e.isGeographic&&null!=s&&null!=h){const r=.001,i=1e3;if(Math.abs(t.xmin-s)<r&&Math.abs(h-t.xmax)>i&&Math.abs(180-o.xmax)<c){o.xmin=-180;const r=[];r.push(new l.Z(t.xmax,t.ymin,a)),r.push(new l.Z(t.xmax,(t.ymin+t.ymax)/2,a)),r.push(new l.Z(t.xmax,t.ymax,a));const i=r.map((t=>g(t,e,n))).filter((t=>!isNaN(null==t?void 0:t.x))).map((t=>t.x));o.xmax=Math.max.apply(null,i)}if(Math.abs(t.xmax-h)<r&&Math.abs(s-t.xmin)>i&&Math.abs(180+o.xmin)<c){o.xmax=180;const r=[];r.push(new l.Z(t.xmin,t.ymin,a)),r.push(new l.Z(t.xmin,(t.ymin+t.ymax)/2,a)),r.push(new l.Z(t.xmin,t.ymax,a));const i=r.map((t=>g(t,e,n))).filter((t=>!isNaN(null==t?void 0:t.x))).map((t=>t.x));o.xmin=Math.min.apply(null,i)}}[s,h]=v(e,!0);const f=y(e);return f&&null!=s&&null!=h&&o&&(Math.abs(o.xmin-s)<f&&(o.xmin=s),Math.abs(o.xmax-h)<f&&(o.xmax=h)),o}function b(t,e=!1){const n=e?20037508.342787:20037508.342788905;return t.isWebMercator?2*n:t.wkid&&t.isGeographic?360:2*x[t.wkid]||null}function v(t,e=!1){const n=[],r=b(t,e);return(0,a.pC)(r)&&(n.push(-r/2),n.push(r/2)),n}function R(t,e,n,r){let a=(t-e)/n;return a-Math.floor(a)!=0?a=Math.floor(a):r&&(a-=1),a}function P(t,e=!1){const n=b(t.spatialReference);if(!(0,a.pC)(n))return 0;const r=e?0:-n/2;return R(t.xmax,r,n,!0)-R(t.xmin,r,n,!1)}function S(t){const e=t.storageInfo.origin.x,n=b(t.spatialReference,!0);if(!(0,a.pC)(n))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const r=n/2,{nativePixelSize:o,storageInfo:i,extent:s}=t,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=i;let u=o.x;const f=[],x=(0,a.pC)(t.transform)&&"gcs-shift"===t.transform.type,p=e+(x?0:r),m=x?n-e:r-e;for(let t=0;t<=l;t++){const t=(s.xmax-e)/u/c,n=t-Math.floor(t)==0?t:Math.ceil(t),r=m/u/c,a=r-Math.floor(r)==0?r:Math.ceil(r),o=Math.floor(p/u/c),i=Math.round(p/u)%c,l=(c-Math.round(m/u)%c)%c;f.push({resolutionX:u,blockWidth:c,datsetColumnCount:n,worldColumnCountFromOrigin:a,leftMargin:i,rightPadding:l,originColumnOffset:o}),u*=h}return{originX:e,halfWorldWidth:r,pyramidsInfo:f,hasGCSSShiftTransform:x}}function A(t){const e=t.isAdaptive&&null==t.spacing,n=t.spacing||[32,32];let r=I(t),a={cols:r.size[0]+1,rows:r.size[1]+1},o=f(r.offsets,a,n);const i=(o[0]+o[1])/2,s=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;return e&&(s||i>4)&&(r=I({...t,spacing:[4,4]}),a={cols:r.size[0]+1,rows:r.size[1]+1},o=f(r.offsets,a,n)),r.error=o,r.coefficients=function(t,e,n){const{cols:r,rows:a}=e,o=new Float32Array((r-1)*(a-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),s=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<r-1;e++){for(let n=0;n<a-1;n++){let l=e*a*2+2*n;const c=t[l],h=t[l+1],u=t[l+2],f=t[l+3];l+=2*a;const x=t[l],p=t[l+1],m=t[l+2],d=t[l+3];let y=0,g=12*(n*(r-1)+e);for(let t=0;t<3;t++)o[g++]=i[y++]*c+i[y++]*u+i[y++]*m;y=0;for(let t=0;t<3;t++)o[g++]=i[y++]*h+i[y++]*f+i[y++]*d;y=0;for(let t=0;t<3;t++)o[g++]=s[y++]*c+s[y++]*x+s[y++]*m;y=0;for(let t=0;t<3;t++)o[g++]=s[y++]*h+s[y++]*p+s[y++]*d}if(n)for(let t=0;t<o.length;t++)isNaN(o[t])&&(o[t]=-1)}return o}(r.offsets,a,s),r}function I(t){const{projectedExtent:e,srcBufferExtent:n,pixelSize:r,datumTransformation:o,rasterTransform:s}=t,c=e.spatialReference,h=n.spatialReference;u(c,h);const{xmin:f,ymin:x,xmax:p,ymax:m}=e,d=b(h),y=t.hasWrapAround||"gcs-shift"===(null==s?void 0:s.type),g=t.spacing||[32,32],M={x:g[0]*r.x,y:g[1]*r.y},w=Math.ceil((p-f)/M.x-.1/g[0])+1,k=Math.ceil((m-x)/M.y-.1/g[1])+1,v=M.x,R=M.y,P=[];let S,A=0;const I=[];for(let t=0;t<w;t++)for(let e=0;e<k;e++)I.push(new l.Z({x:f+v*t,y:m-R*e,spatialReference:c}));const C=function(t,e,n=null){const r=t[0].spatialReference;return r.equals(e)?t:(u(r,e,n),(0,i.iV)(t,e,n))}(I,h,o);for(let t=0;t<w;t++){const e=[];for(let r=0;r<k;r++){let o=C[t*k+r];s&&(o=s.inverseTransform(o)),e.push(o),t>0&&y&&o&&S[r]&&(0,a.pC)(d)&&o.x<S[r].x&&(o.x+=d),o?(P.push((o.x-n.xmin)/(n.xmax-n.xmin)),P.push((n.ymax-o.y)/(n.ymax-n.ymin))):(P.push(NaN),P.push(NaN),A++)}S=e}return{offsets:P,error:null,coefficients:null,outofBoundPointCount:A,spacing:g,size:[w-1,k-1]}}function C(t){const e=t.clone().normalize();return 1===e.length?e[0]:M(e)}function F(t,e,n){const{storageInfo:r,pixelSize:o}=e;let i,s=!1;const{pyramidResolutions:c}=r;if((0,a.pC)(c)&&c.length){const r=(t.x+t.y)/2,a=c[c.length-1],h=(a.x+a.y)/2,u=(o.x+o.y)/2;if(r<=u)i=0;else if(r>=h)i=c.length,s=r/h>8;else{let t,e=u;for(let a=1;a<=c.length;a++){if(t=(c[a-1].x+c[a-1].y)/2,r<=t){r===t?i=a:"down"===n?(i=a-1,s=r/e>8):i="up"===n||r-e>t-r||r/e>2?a:a-1;break}e=t}}const f=0===i?o:c[i-1];return{pyramidLevel:i,pyramidResolution:new l.Z({x:f.x,y:f.y,spatialReference:e.spatialReference}),excessiveReading:s}}const h=Math.log(t.x/o.x)/Math.LN2,u=Math.log(t.y/o.y)/Math.LN2,f=e.storageInfo.maximumPyramidLevel||0;i="down"===n?Math.floor(Math.min(h,u)):"up"===n?Math.ceil(Math.max(h,u)):Math.round((h+u)/2),i<0?i=0:i>f&&(s=i>f+3,i=f);const x=2**i;return{pyramidLevel:i,pyramidResolution:new l.Z({x:x*e.nativePixelSize.x,y:x*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:s}}function Z(t,e,n=512,r=!0){const{extent:a,spatialReference:i,pixelSize:s}=t,c=d(new l.Z({x:s.x,y:s.y,spatialReference:i}),e,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(c.x+c.y)/2,u=(0,o.c9)(e),f=h*u*96*39.37,x=e.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let p="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const m=w(a,e);p||r&&(e.isGeographic||e.isWebMercator)&&(p=m.xmin*m.xmax<0);let y,g=f;const M=1.001;if(p){g=x;const t=e.isGeographic?1341104507446289e-21:.29858214164761665,n=t*(96*u*39.37),r=e.isGeographic?4326:3857;y=d(new l.Z({x:t,y:t,spatialReference:{wkid:r}}),i,m),y.x*=g/n,y.y*=g/n}else{y={x:s.x,y:s.y};const e=Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2);let n=0;for(;g<x*(M/2)&&n<e;)n++,g*=2,y.x*=2,y.y*=2;Math.max(g,x)/Math.min(g,x)<=M&&(g=x)}const k=[g],b=[{x:y.x,y:y.y}],v=Math.min(70.5310735,f)/M;for(;g>=v;)g/=2,y.x/=2,y.y/=2,k.push(g),b.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:k,srcResolutions:b,isCustomTilingScheme:!p}}},7928:(t,e,n)=>{n.d(e,{KC:()=>p,QI:()=>m,wF:()=>A,K:()=>S,Yx:()=>h,nb:()=>I,BH:()=>d,NL:()=>c,Tg:()=>f});var r=n(25709),a=n(61681),o=n(34780),i=n(31329);const s=new Map;s.set("meter-per-second",1),s.set("kilometer-per-hour",.277778),s.set("knots",.514444),s.set("feet-per-second",.3048),s.set("mile-per-hour",.44704);const l=180/Math.PI,c=new r.Xn({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function h(t,e){return s.get(t)/s.get(e)||1}function u(t){return(450-t)%360}function f(t,e="geographic"){const[n,r]=t,a=Math.sqrt(n*n+r*r);let o=Math.atan2(r,n)*l;return o=(360+o)%360,"geographic"===e&&(o=u(o)),[a,o]}function x(t,e="geographic"){let n=t[1];"geographic"===e&&(n=u(n)),n%=360;const r=t[0];return[r*Math.cos(n/l),r*Math.sin(n/l)]}function p(t,e,n="geographic",r=1){if(!(0,i.nk)(t))return t;const{pixels:a,width:s,height:l}=t,c=s*l,h=a[0],u=a[1],p=o.Z.createEmptyBand(t.pixelType,c),m=o.Z.createEmptyBand(t.pixelType,c);let d=0;for(let t=0;t<l;t++)for(let t=0;t<s;t++)"vector-uv"===e?([p[d],m[d]]=f([h[d],u[d]],n),p[d]*=r):([p[d],m[d]]=x([h[d],u[d]],n),p[d]*=r,m[d]*=r),d++;const y=new o.Z({pixelType:t.pixelType,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[p,m]});return y.updateStatistics(),y}function m(t,e,n=1){if(1===n||!(0,i.nk)(t))return t;const r=t.clone(),{pixels:a,width:o,height:s}=r,l=a[0],c=a[1];let h=0;for(let t=0;t<s;t++)for(let t=0;t<o;t++)"vector-uv"===e?(l[h]*=n,c[h]*=n):l[h]*=n,h++;return r.updateStatistics(),r}function d(t,e,n,r,o){if(!(0,a.pC)(o)||!o.spatialReference.equals(t.spatialReference))return{extent:t,width:e,height:n,resolution:t.width/e};const i=o.xmin,s=o.ymax;r=Math.max(r||0,30);const l=Math.ceil(e*(1/r)),c=Math.ceil(n*(1/r)),h=((t.xmax-t.xmin)/l+(t.ymax-t.ymin)/c)/2;return t.xmin=i+Math.floor((t.xmin-i)/h)*h,t.xmax=i+Math.ceil((t.xmax-i)/h)*h,t.ymin=s+Math.floor((t.ymin-s)/h)*h,t.ymax=s+Math.ceil((t.ymax-s)/h)*h,{extent:t,width:Math.round(t.width/h),height:Math.round(t.height/h),resolution:h}}const y=function(t=0,e=0,n=Math.PI,r=!0){r&&(n=(2*Math.PI-n)%(2*Math.PI));const a=r?-1:1,o=13*a,i=-7*a,s=-2*a,l=-16*a,c=29,[h,u]=M(0,e+o,n,c),[f,x]=M(t-5.5,e+i,n,c),[p,m]=M(t+5.5,e+i,n,c),[d,y]=M(t-1.5,e+s,n,c),[g,w]=M(t+1.5,e+s,n,c),[k,b]=M(t-1.5,e+l,n,c),[v,R]=M(t+1.5,e+l,n,c);return[h,u,f,x,d,y,g,w,p,m,k,b,v,R]}(0,0,0);function g(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const r=n?-1:1,a=5*r,o=20*r,i=25*r,s=45,l=2*r;let[c,h]=[5,0-o],[u,f]=[c+2,h],[x,p]=[u-0,f+l],[m,d]=[-5,0-i],[y,g]=[m+0,d-l],w=Math.ceil(t/5),k=Math.floor(w/10);w-=8*k;const b=[],v=[];for(let t=0;t<w/2;t++,k--){k<=0&&w%2==1&&t===(w-1)/2&&(m=0,y=m+0,d=(d+h)/2,g=d-l);const[n,r]=M(m,d,e,s);if(k>0){const[t,a]=M(u,d,e,s),[o,i]=M(c,h,e,s);b.push(t),b.push(a),b.push(n),b.push(r),b.push(o),b.push(i)}else{const[t,a]=M(u,f,e,s),[o,i]=M(x,p,e,s),[l,c]=M(y,g,e,s);v.push(n),v.push(r),v.push(l),v.push(c),v.push(o),v.push(i),v.push(t),v.push(a)}d+=a,h+=a,f+=a,p+=a,g+=a}const[R,P]=M(5,0+o,e,s),[S,A]=M(7,0+o,e,s),[I,C]=M(5,0-i,e,s),[F,Z]=M(7,0-i,e,s);return{pennants:b,barbs:v,shaft:[R,P,S,A,I,C,F,Z]}}function M(t,e,n,r=1){const a=Math.sqrt(t*t+e*e)/r,o=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[a,(2*Math.PI+o-n)%(2*Math.PI)]}const w=[0,1,3,6,10,16,21,27,33,40,47,55,63],k=[0,.5,1,1.5,2],b=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function v(t,e,n,r){const a=h(r||"knots",n);let o;for(o=1;o<e.length;o++)if(o===e.length-1){if(t<e[o]*a)break}else if(t<=e[o]*a)break;return Math.min(o-1,e.length-2)}function R(t,e,n,r,a){let o=0;switch(e){case"beaufort_kn":o=v(t,w,"knots",n);break;case"beaufort_km":o=v(t,w,"kilometer-per-hour",n);break;case"beaufort_ft":o=v(t,w,"feet-per-second",n);break;case"beaufort_m":o=v(t,w,"meter-per-second",n);break;case"classified_arrow":o=v(t,a,r,n);break;case"ocean_current_m":o=v(t,k,"meter-per-second",n);break;case"ocean_current_kn":o=v(t,b,"knots",n)}return o}const P=[];function S(t,e){let n=0,r=0;const{width:a,height:o,mask:i}=t,s=t.pixels[0],l=[],c=[],h="wind_speed"===e.style?5:Number.MAX_VALUE;for(let t=0;t<o;t++)for(let e=0;e<a;e++){const u=t*a+e;if((!i||i[t*a+e])&&s[u]<h){for(let r=0;r<4;r++)l[n++]=(e+.5)/a,l[n++]=(t+.5)/o,l[n++]=r<2?-.5:.5,l[n++]=r%2==0?-.5:.5,l[n++]=0,l[n++]=s[u];const i=4*(n/24-1);c[r++]=i,c[r++]=i+1,c[r++]=i+2,c[r++]=i+1,c[r++]=i+2,c[r++]=i+3}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(c)}}function A(t,e){return"simple_scalar"===e.style?S(t,e):"wind_speed"===e.style?function(t,e){if(0===P.length)for(let t=0;t<30;t++)P.push(g(5*t,0));const n=h(c.fromJSON(e.inputUnit),"knots"),{width:r,height:a,mask:o}=t,i=t.pixels[0],s=t.pixels[1],l=[],u=[];let f=0,x=0;for(let t=0;t<a;t++)for(let e=0;e<r;e++){const c=t*r+e,h=i[c]*n;if((!o||o[t*r+e])&&h>=5){var p;const n=null!=(p=(s[c]+360)%360/180*Math.PI)?p:2*Math.PI*Math.random(),{pennants:o,barbs:i,shaft:m}=P[Math.min(Math.floor(h/5),29)];if(o.length+i.length===0)continue;let d=l.length/6;const y=(e+.5)/r,g=(t+.5)/a;for(let t=0;t<o.length;t+=2)l[f++]=y,l[f++]=g,l[f++]=o[t],l[f++]=o[t+1]+n,l[f++]=0,l[f++]=h;for(let t=0;t<i.length;t+=2)l[f++]=y,l[f++]=g,l[f++]=i[t],l[f++]=i[t+1]+n,l[f++]=0,l[f++]=h;for(let t=0;t<m.length;t+=2)l[f++]=y,l[f++]=g,l[f++]=m[t],l[f++]=m[t+1]+n,l[f++]=0,l[f++]=h;for(let t=0;t<o.length/6;t++)u[x++]=d,u[x++]=d+1,u[x++]=d+2,d+=3;for(let t=0;t<i.length/8;t++)u[x++]=d,u[x++]=d+1,u[x++]=d+2,u[x++]=d+1,u[x++]=d+2,u[x++]=d+3,d+=4;u[x++]=d+0,u[x++]=d+1,u[x++]=d+2,u[x++]=d+1,u[x++]=d+3,u[x++]=d+2,d+=4}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(u)}}(t,e):function(t,e){const{style:n,inputUnit:r,outputUnit:a,breakValues:o}=e,i=c.fromJSON(r),s=c.fromJSON(a);let l=0,h=0;const{width:u,height:f,mask:x}=t,p=t.pixels[0],m=t.pixels[1],d=x?x.filter((t=>t>0)).length:u*f,g=new Float32Array(42*d),M=new Uint32Array(15*d);for(let t=0;t<f;t++)for(let e=0;e<u;e++){const r=t*u+e;if(!x||x[t*u+e]){var w;const a=null!=(w=(m[r]+360)%360/180*Math.PI)?w:2*Math.PI*Math.random(),c=R(p[r],n,i,s,o);for(let n=0;n<y.length;n+=2)g[l++]=(e+.5)/u,g[l++]=(t+.5)/f,g[l++]=y[n],g[l++]=y[n+1]+a,g[l++]=c,g[l++]=p[r];const x=7*(l/42-1);M[h++]=x,M[h++]=x+1,M[h++]=x+2,M[h++]=x+0,M[h++]=x+4,M[h++]=x+3,M[h++]=x+0,M[h++]=x+2,M[h++]=x+3,M[h++]=x+2,M[h++]=x+5,M[h++]=x+3,M[h++]=x+5,M[h++]=x+6,M[h++]=x+3}}return{vertexData:g,indexData:M}}(t,e)}function I(t,e,n,r=[0,0],a=.5){const{width:i,height:s,mask:l}=t,[c,h]=t.pixels,[u,p]=r,m=Math.round((i-u)/n),d=Math.round((s-p)/n),y=m*d,g=new Float32Array(y),M=new Float32Array(y),w=new Uint8Array(y),k="vector-uv"===e;for(let t=0;t<d;t++)for(let e=0;e<m;e++){let r=0;const o=t*m+e,d=Math.max(0,t*n+p),y=Math.max(0,e*n+u),b=Math.min(s,d+n),v=Math.min(i,y+n);for(let t=d;t<b;t++)for(let e=y;e<v;e++){const n=t*i+e;if(!l||l[n]){r++;const t=k?[c[n],h[n]]:[c[n],(360+h[n])%360],[e,a]=k?t:x(t);g[o]+=e,M[o]+=a}}if(r>=(b-d)*(v-y)*(1-a)){w[o]=1;const[t,e]=f([g[o]/r,M[o]/r]);g[o]=t,M[o]=e}else w[o]=0,g[o]=0,M[o]=0}const b=new o.Z({width:m,height:d,pixels:[g,M],mask:w});return b.updateStatistics(),b}},88243:(t,e,n)=>{n.d(e,{z_:()=>u,KK:()=>m}),n(91957);var r=n(13802),a=n(19431),o=n(61681),i=n(78668),s=n(4157),l=n(35925),c=n(91772);const h=r.Z.getLogger("esri.views.2d.engine.flow.dataUtils");async function u(t,e,n){const r=performance.now(),a=function(t,e){const n=function(t,e,n,r){if(0===r)return t;const a=Math.round(3*r),o=new Array(2*a+1);let i=0;for(let t=-a;t<=a;t++){const e=Math.exp(-t*t/(r*r));o[t+a]=e,i+=e}for(let t=-a;t<=a;t++)o[t+a]/=i;const s=new Float32Array(t.length);for(let r=0;r<n;r++)for(let n=0;n<e;n++){let i=0,l=0;for(let s=-a;s<=a;s++){if(n+s<0||n+s>=e)continue;const c=o[s+a];i+=c*t[2*(r*e+(n+s))+0],l+=c*t[2*(r*e+(n+s))+1]}s[2*(r*e+n)+0]=i,s[2*(r*e+n)+1]=l}const l=new Float32Array(t.length);for(let t=0;t<e;t++)for(let r=0;r<n;r++){let i=0,c=0;for(let l=-a;l<=a;l++){if(r+l<0||r+l>=n)continue;const h=o[l+a];i+=h*s[2*((r+l)*e+t)+0],c+=h*s[2*((r+l)*e+t)+1]}l[2*(r*e+t)+0]=i,l[2*(r*e+t)+1]=c}return l}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,r)=>{const a=Math.floor(t),o=Math.floor(r);if(a<0||a>=e.width)return[0,0];if(o<0||o>=e.height)return[0,0];const i=t-a,s=r-o,l=a,c=o,h=a<e.width-1?a+1:a,u=o<e.height-1?o+1:o,f=n[2*(c*e.width+l)],x=n[2*(c*e.width+h)],p=n[2*(u*e.width+l)],m=n[2*(u*e.width+h)],d=n[2*(c*e.width+l)+1],y=n[2*(c*e.width+h)+1];return[(f*(1-s)+p*s)*(1-i)+(x*(1-s)+m*s)*i,(d*(1-s)+n[2*(u*e.width+l)+1]*s)*(1-i)+(y*(1-s)+n[2*(u*e.width+h)+1]*s)*i]}:(t,r)=>{const a=Math.round(t),o=Math.round(r);return a<0||a>=e.width||o<0||o>=e.height?[0,0]:[n[2*(o*e.width+a)+0],n[2*(o*e.width+a)+1]]}}(t,e),o=performance.now(),l=x(t,a,e.width,e.height),c=performance.now(),u=function(t,e){const n=new s.Z,r=t.reduce(((t,e)=>t+e.length),0),a=new Float32Array(3*r),o=new Array(t.length);let i=0,l=0;for(const e of t){const t=i;for(const t of e)a[3*i+0]=t.x,a[3*i+1]=t.y,a[3*i+2]=t.t,i++;o[l++]={startVertex:t,numberOfVertices:e.length,totalTime:e[e.length-1].t,timeSeed:n.getFloat()}}return{lineVertices:a,lineDescriptors:o}}(l),f=performance.now(),p=function(t,e=10){const{lineVertices:n,lineDescriptors:r}=t;let a=0,o=0;for(const t of r)a+=2*t.numberOfVertices,o+=6*(t.numberOfVertices-1);const i=new Float32Array(8*a),s=new Uint32Array(o);let l=0,c=0;function h(){s[c++]=l-2,s[c++]=l,s[c++]=l-1,s[c++]=l,s[c++]=l+1,s[c++]=l-1}function u(t,e,n,r,a,o,s){const c=8*l;let h=0;i[c+h++]=t,i[c+h++]=e,i[c+h++]=1,i[c+h++]=n,i[c+h++]=o,i[c+h++]=s,i[c+h++]=r,i[c+h++]=a,l++,i[c+h++]=t,i[c+h++]=e,i[c+h++]=-1,i[c+h++]=n,i[c+h++]=o,i[c+h++]=s,i[c+h++]=-r,i[c+h++]=-a,l++}for(const t of r){const{totalTime:r,timeSeed:a}=t;let o=null,i=null,s=null,l=null,c=null;for(let f=0;f<t.numberOfVertices;f++){const x=n[3*(t.startVertex+f)+0],p=n[3*(t.startVertex+f)+1],m=n[3*(t.startVertex+f)+2];let d=null,y=null,g=null,M=null;if(f>0){d=x-o,y=p-i;const t=Math.sqrt(d*d+y*y);if(d/=t,y/=t,f>1){let t=d+l,n=y+c;const r=Math.sqrt(t*t+n*n);t/=r,n/=r;const a=Math.min(1/(t*d+n*y),e);t*=a,n*=a,g=-n,M=t}else g=-y,M=d;null!==g&&null!==M&&(u(o,i,s,g,M,r,a),h())}o=x,i=p,s=m,l=d,c=y}u(o,i,s,-c,l,r,a)}return{vertexData:i,indexData:s}}(u),m=performance.now();if(t.profile){const t={"_createFlowFieldFromData()":Math.round(o-r),"_getStreamlines()":Math.round(c-o),"createAnimatedLinesData()":Math.round(f-c),"createLinesMesh()":Math.round(m-f),"Total elapsed time":Math.round(m-r)};h.info("createStreamlinesMesh profile",t)}return await Promise.resolve(),(0,i.k_)(n),p}function f(t,e,n,r,a,o,i,s,l){const c=[];let h,u,f=n,x=r,p=0;c.push({x:f,y:x,t:p});for(let n=0;n<t.verticesPerLine;n++){let[n,r]=e(f,x);n*=t.velocityScale,r*=t.velocityScale;const m=Math.sqrt(n*n+r*r);if(m<t.minSpeedThreshold)return c;const d=n/m,y=r/m;if(f+=d*t.segmentLength,x+=y*t.segmentLength,p+=t.segmentLength/m,Math.acos(d*h+y*u)>t.maxTurnAngle)return c;if(t.mergeLines){const t=Math.round(f*l),e=Math.round(x*l);if(t<0||t>i-1||e<0||e>s-1)return c;const n=o[e*i+t];if(-1!==n&&n!==a)return c;o[e*i+t]=a}c.push({x:f,y:x,t:p}),h=d,u=y}return c}function x(t,e,n,r){const a=[],o=new s.Z,i=1/Math.max(t.lineCollisionWidth,1),l=Math.round(n*i),c=Math.round(r*i),h=new Int32Array(l*c);for(let t=0;t<h.length;t++)h[t]=-1;const u=[];for(let e=0;e<r;e+=t.lineSpacing)for(let r=0;r<n;r+=t.lineSpacing)u.push({x:r,y:e,sort:o.getFloat()});u.sort(((t,e)=>t.sort-e.sort));for(const{x:n,y:r}of u)if(o.getFloat()<t.density){const o=f(t,e,n,r,a.length,h,l,c,i);if(o.length<2)continue;a.push(o)}return a}function p(t,e){const n=e.pixels,{width:r,height:o}=e,i=new Float32Array(r*o*2);if("vector-uv"===t)for(let t=0;t<r*o;t++)i[2*t+0]=n[0][t],i[2*t+1]=-n[1][t];else if("vector-magdir"===t)for(let t=0;t<r*o;t++){const e=n[0][t],r=(0,a.Vl)(n[1][t]),o=Math.cos(r-Math.PI/2),s=Math.sin(r-Math.PI/2);i[2*t+0]=o*e,i[2*t+1]=s*e}return{data:i,width:r,height:o}}async function m(t,e,n,r,a){const o=(0,l.C5)(e.spatialReference);if(!o)return d(t,e,n,r,a);const[i,s]=o.valid,h=s-i,u=Math.ceil(e.width/h),f=e.width/u,x=Math.round(n/u);let p=e.xmin;const m=[];for(let n=0;n<u;n++){const n=new c.Z({xmin:p,xmax:p+f,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});m.push(d(t,n,x,r,a)),p+=f}const y=await Promise.all(m),g={data:new Float32Array(n*r*2),width:n,height:r};let M=0;for(const t of y){for(let e=0;e<t.height;e++)for(let r=0;r<t.width;r++)M+r>=n||(g.data[2*(e*n+M+r)+0]=t.data[2*(e*t.width+r)+0],g.data[2*(e*n+M+r)+1]=t.data[2*(e*t.width+r)+1]);M+=t.width}return g}async function d(t,e,n,r,a){if("imagery"===t.type){await t.load({signal:a});const i=t.rasterInfo.dataType,s=await t.fetchImage(e,n,r,{signal:a});return!s||(0,o.Wi)(s.pixelData)||(0,o.Wi)(s.pixelData.pixelBlock)?{data:new Float32Array(n*r*2),width:n,height:r}:p(i,s.pixelData.pixelBlock)}await t.load({signal:a});const i=t.rasterInfo.dataType,s=await t.fetchPixels(e,n,r,{signal:a});return!s||(0,o.Wi)(s.pixelBlock)?{data:new Float32Array(n*r*2),width:n,height:r}:p(i,s.pixelBlock)}}}]);
//# sourceMappingURL=8299.js.map