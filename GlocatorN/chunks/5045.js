"use strict";(self.webpackChunkmomraGisCore=self.webpackChunkmomraGisCore||[]).push([[5045],{45045:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool2D:()=>_});var r=i(36663),a=(i(91957),i(80085)),s=i(23148),n=i(61681),l=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),h=i(36609),p=(i(4905),i(62589)),c=i(1759);const u=new p.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),d=new c.Z({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),y=new c.Z({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var m=i(70008),v=i(86936),g=i(15991),x=i(53446),f=i(74304);let _=class extends m.T{constructor(e){super(e),this._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:(0,n.Pt)(e.activeLineSymbol,u),regularVertices:(0,n.Pt)(e.regularVerticesSymbol,d),activeVertex:(0,n.Pt)(e.activeVertexSymbol,y),fill:(0,n.Wg)(e.activeFillSymbol)}}initializeGraphic(e){return(0,n.pC)(this._visualElementSymbols.fill)&&(e.symbol=this._visualElementSymbols.fill),null}makeDrawOperation(){const e=this.view;return new v.w({view:e,manipulators:this.manipulators,geometryType:(0,m.I)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new g.hP(e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new h.r(this.internalGraphicsLayer)})}onActiveVertexChanged(e){if("point"===this.geometryType)return null;const[t,i]=e,r=new x.Z({x:t,y:i,spatialReference:this.drawOperation.spatialReference});return(0,n.pC)(this._visualElementGraphics.activeVertex)?(this._visualElementGraphics.activeVertex.geometry=r,null):(this._visualElementGraphics.activeVertex=new a.Z({geometry:r,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(w),(0,s.kB)((()=>{(0,n.pC)(this._visualElementGraphics.activeVertex)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,n.SC)(this._visualElementGraphics.activeVertex))})))}onOutlineChanged(e){const t=e.clone();if("polyline"===t.type){const e=t.paths[t.paths.length-1];e.splice(0,e.length-2)}return(0,n.pC)(this._visualElementGraphics.outline)?(this._visualElementGraphics.outline.geometry=t,null):(this._visualElementGraphics.outline=new a.Z({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(w),(0,s.kB)((()=>{(0,n.pC)(this._visualElementGraphics.outline)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.outline),this._visualElementGraphics.outline=(0,n.SC)(this._visualElementGraphics.outline))})))}onRegularVerticesChanged(e){const t=new f.Z({points:e,spatialReference:this.drawOperation.spatialReference});return(0,n.pC)(this._visualElementGraphics.regularVertices)?(this._visualElementGraphics.regularVertices.geometry=t,null):(this._visualElementGraphics.regularVertices=new a.Z({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(w),(0,s.kB)((()=>{(0,n.pC)(this._visualElementGraphics.regularVertices)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,n.SC)(this._visualElementGraphics.regularVertices))})))}};function w(e,t){var i,r,a,s;return(null!=(i=null==(r=e.attributes)?void 0:r.displayOrder)?i:-1/0)-(null!=(a=null==(s=t.attributes)?void 0:s.displayOrder)?a:-1/0)}(0,r._)([(0,l.Cb)()],_.prototype,"activeFillSymbol",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],_.prototype,"type",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),_=(0,r._)([(0,o.j)("esri.views.2d.interactive.draw.DrawGraphicTool2D")],_)},70008:(e,t,i)=>{i.d(t,{T:()=>R,I:()=>Z});var r=i(36663),a=i(80085),s=(i(39994),i(31355)),n=i(53280),l=i(23148),o=i(61681),h=i(81977),p=i(7753),c=(i(7283),i(40266)),u=i(45857),d=(i(91957),i(67134)),y=i(17321),m=i(32284),v=i(17700),g=i(38028),x=i(35925),f=i(9712),_=i(74304),w=i(53446),b=i(90819),C=i(89542);function G(e,t){const i=new w.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function V(e,t,i){const r=new b.Z({paths:e,spatialReference:t});return i&&(0,g.nc)(r),r}function O(e,t,i,r=!0){const a=(0,d.d9)(e);a.forEach((e=>{const t=e[0],i=e[e.length-1];(0,p.fS)(t,i)&&1!==e.length||e.push(e[0])}));let s=new C.Z({rings:a,spatialReference:t});return s.rings.forEach((e=>{(0,g.bu)(e,!1,!1)||e.reverse()})),i&&(0,g.nc)(s),r&&s.isSelfIntersecting&&(0,x.JY)(t)&&(s=(0,v.simplify)(s)),s}function M(e,t,i){const r=t.mapToLocalMultiple(e),a=[],s={x:r[0].x,y:r[0].y},n=r[1].x,l=r[1].y,h=Math.round(n-s.x),p=Math.round(l-s.y),c=Math.max(Math.abs(h),Math.abs(p));if(i){const e={x:s.x+c,y:s.y+c},t={x:s.x-c,y:s.y-c};a.push((0,f.Q8)(e.x,t.y),(0,f.Q8)(t.x,t.y),(0,f.Q8)(t.x,e.y),(0,f.Q8)(e.x,e.y))}else{const e={x:h>0?s.x+c:s.x-c,y:p>0?s.y+c:s.y-c};a.push((0,f.Q8)(s.x,s.y),(0,f.Q8)(e.x,s.y),(0,f.Q8)(e.x,e.y),(0,f.Q8)(s.x,e.y))}return O([(0,o.lV)(a.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function S(e,t,i,r){const a=t.mapToLocalMultiple(e);let s=null,n=null;if(i)s=a[0],n=a[1];else{const e=a[0],t=a[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),l=Math.max(Math.abs(i),Math.abs(r));s=(0,f.Q8)(i>0?e.x+l/2:e.x-l/2,r>0?e.y+l/2:e.y-l/2),n=(0,f.Q8)(Math.abs(i)>Math.abs(r)?s.x-l/2:s.x,Math.abs(i)>Math.abs(r)?s.y:s.y-l/2)}const l=t.localToMap(s),h=t.localToMap(n);if((0,o.Wi)(l)||(0,o.Wi)(h))return null;t.doUnnormalization&&(0,g.Sq)([[l,h]],t.spatialReference);const p=G(l,t.spatialReference),c=G(h,t.spatialReference),u=(0,y.c9)(t.spatialReference);let d=0;if((0,x.JY)(t.spatialReference))d=u*(0,v.distance)(p,c,null);else{const e=s.x-n.x,t=s.y-n.y;d=u*Math.sqrt(e*e+t*t)*(r||1)}const _=new m.Z({center:p,radius:d,radiusUnit:"meters",spatialReference:t.spatialReference});return O(_.rings,_.spatialReference,!1)}var E=i(68610);let R=class extends((0,n.p)(s.Z.EventedMixin(E.m))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new u.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.complete()}destroy(){this.drawOperation=(0,o.SC)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,o.SC)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),(0,o.pC)(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new a.Z({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,l.kB)((()=>{(0,o.pC)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=(0,o.SC)(this._graphic))})),T)}_destroyAllVisualisations(){this.handles.remove(L.outline),this.handles.remove(L.regularVertices),this.handles.remove(L.activeVertex),this.handles.remove(T)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,r=i.slice();(0,o.pC)(t)&&r.push(this.drawOperation.coordinateHelper.pointToArray(t));const a=(0,o.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],s={regularVertices:null,activeVertex:null,full:null,outline:null},n=r.length,l=this.drawOperation.spatialReference,h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":s.regularVertices=i,s.activeVertex=a,s.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":s.regularVertices=i,s.activeVertex=a,n>0&&(s.full=function(e,t){return new _.Z({points:e,spatialReference:t})}(r,l));break;case"polyline":s.regularVertices=i,s.activeVertex=a,n>0&&(s.full=V([r],l,h));break;case"polygon":s.regularVertices=i,s.activeVertex=a,n>0&&(s.full=O([r],l,h,!0));break;case"circle":if(n>0){const t=(0,f.Gn)(this.view,r[0]);if(1===n&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+Q*this.view.resolution,e[1]);s.full=S([e,i],t,!0)}else 2===n&&(s.full=this.forceUniformSize?S(r,t,this.centered):function(e,t,i){const r=t.mapToLocalMultiple(e),a=r[0],s=r[1],n=Math.round(s.x-a.x),l=Math.round(s.y-a.y),h=(0,f.Q8)(i?a.x:a.x+n/2,i?a.y:a.y+l/2),p=i?n:n/2,c=i?l:l/2,u=[],d=2*Math.PI/60;for(let e=0;e<60;e++){const t=Math.cos(e*d),i=Math.sin(e*d),r=(0,f.Q8)(p*t+h.x,c*i+h.y);u.push(r)}return u.push(u[0]),O([(0,o.lV)(u.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(r,t,this.centered))}break;case"rectangle":if(n>0){const t=(0,f.Gn)(this.view,r[0]);if(1===n&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+Q*this.view.resolution,e[1]);s.full=M([e,i],t,!0)}else 2===n&&(s.full=this.forceUniformSize?M(r,t,this.centered):function(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[(0,f.Q8)(t.x-e,t.y+e),(0,f.Q8)(t.x+e,t.y-e),(0,f.Q8)(t.x+e,t.y-e),(0,f.Q8)(t.x-e,t.y+e)]}const a=[],s={x:r[0].x,y:r[0].y},n={x:r[1].x,y:r[1].y};if(i){const e=Math.round(n.x-s.x),t=Math.round(n.y-s.y);a.push((0,f.Q8)(s.x-e,s.y-t),(0,f.Q8)(n.x,s.y-t),(0,f.Q8)(n.x,n.y),(0,f.Q8)(s.x-e,n.y))}else a.push((0,f.Q8)(s.x,s.y),(0,f.Q8)(n.x,s.y),(0,f.Q8)(n.x,n.y),(0,f.Q8)(s.x,n.y));return O([(0,o.lV)(a.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(r,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":n>1&&(s.outline=V([r],l,h));break;case"circle":case"rectangle":(0,o.pC)(s.full)&&"polygon"===s.full.type&&(s.outline=O(s.full.rings,l,h))}return s}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});(0,o.pC)(e)&&(t=new a.Z({geometry:e.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();(0,o.Wi)(e)?this._destroyAllVisualisations():((0,o.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),L.outline):this.handles.remove(L.outline),(0,o.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),L.regularVertices):this.handles.remove(L.regularVertices),(0,o.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),L.activeVertex):this.handles.remove(L.activeVertex),(0,o.pC)(e.full)?(0,o.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(T))}};(0,r._)([(0,h.Cb)({value:!0})],R.prototype,"centered",null),(0,r._)([(0,h.Cb)({nonNullable:!0})],R.prototype,"defaultZ",void 0),(0,r._)([(0,h.Cb)()],R.prototype,"drawOperation",void 0),(0,r._)([(0,h.Cb)({value:!0})],R.prototype,"enabled",null),(0,r._)([(0,h.Cb)({value:!0})],R.prototype,"forceUniformSize",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"geometryType",void 0),(0,r._)([(0,h.Cb)()],R.prototype,"graphic",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"graphicProperties",void 0),(0,r._)([(0,h.Cb)()],R.prototype,"graphicSymbol",null),(0,r._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"hasZ",void 0),(0,r._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"mode",void 0),(0,r._)([(0,h.Cb)()],R.prototype,"snappingManager",void 0),(0,r._)([(0,h.Cb)()],R.prototype,"snapToScene",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],R.prototype,"type",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],R.prototype,"updating",null),(0,r._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],R.prototype,"view",void 0),R=(0,r._)([(0,c.j)("esri.views.draw.DrawGraphicTool")],R);const T="create-operation-graphic",L={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Z(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const Q=48}}]);
//# sourceMappingURL=5045.js.map