"use strict";(self.webpackChunkmomraGisCore=self.webpackChunkmomraGisCore||[]).push([[1280],{61280:(e,t,i)=>{i.d(t,{Z:()=>L});var s=i(70375),n=i(67134),r=i(61681),a=i(40366),l=i(17321),o=i(37116),u=i(24568),c=i(79880),h=i(53736),d=i(56247),f=i(35925),p=i(77234),m=i(3362);const y=new class{constructor(e,t){this._cache=new p.Z(e),this._invalidCache=new p.Z(t)}get(e,t){const i=`${t.uid}:${e}`,s=this._cache.get(i);if(s)return s;if(void 0!==this._invalidCache.get(i))return null;try{const s=m.WhereClause.create(e,t);return this._cache.put(i,s),s}catch{return this._invalidCache.put(i,null),null}}}(50,500),g="feature-store:unsupported-query",x=" as ",S=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function _(e,t){if(!t)return!0;const i=y.get(t,e);if(!i)throw new s.Z(g,"invalid SQL expression",{where:t});if(!i.isStandardized)throw new s.Z(g,"where clause is not standard",{where:t});return F(e,i.fieldNames,"where clause contains missing fields"),!0}function w(e,t,i){if(!t)return!0;const n=y.get(t,e);if(!n)throw new s.Z(g,"invalid SQL expression",{having:t});if(!n.isAggregate)throw new s.Z(g,"having does not contain a valid aggregate function",{having:t});const r=n.fieldNames;if(F(e,r,"having contains missing fields"),!n.getExpressions().every((t=>{const{aggregateType:s,field:n}=t,r=e.has(n)&&e.get(n).name;return i.some((t=>{const{onStatisticField:i,statisticType:n}=t;return(e.has(i)&&e.get(i).name)===r&&n.toLowerCase().trim()===s}))})))throw new s.Z(g,"expressions in having should also exist in outStatistics",{having:t});return!0}function v(e,t){return e?y.get(e,t):null}function F(e,t,i,n=!0){const r=[];for(const i of t)if("*"!==i&&!e.has(i))if(n){const t=b(i);try{const i=v(t,e);if(!i)throw new s.Z(g,"invalid SQL expression",{where:t});if(!i.isStandardized)throw new s.Z(g,"expression is not standard",{clause:i});F(e,i.fieldNames,"expression contains missing fields")}catch(e){const t=e&&e.details;if(t&&(t.clause||t.where))throw e;t&&t.missingFields?r.push(...t.missingFields):r.push(i)}}else r.push(i);if(r.length)throw new s.Z(g,i,{missingFields:r})}function b(e){return e.split(x)[0]}function I(e){return e.split(x)[1]}function R(e,t){const i=t.get(e);return!!i&&!S.has(i.type)}var V=i(66069),T=i(10287),C=i(7505),z=i(12065),A=i(46479);class Q{constructor(e,t,i){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=i,this.featureAdapter=t;const s=e.outFields;if(s&&-1===s.indexOf("*")){this.outFields=s;let e=0;for(const t of s){const s=b(t),n=this.fieldsIndex.get(s),r=n?null:v(s,i),a=n?n.name:I(t)||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:r})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,i){const s=i?i.name:t;let n=null;return this._fieldDataCache.has(s)?n=this._fieldDataCache.get(s).clause:i||(n=v(t,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:n})),i?this.featureAdapter.getAttribute(e,s):n.calculateValue(e,this.featureAdapter)}getNormalizedValue(e,t){const i=t.normalizationType,s=t.normalizationTotal;let n=this.getFieldValue(e,t.field,t.fieldInfo);if(i&&Number.isFinite(n)){const r=this.getFieldValue(e,t.normalizationField,t.normalizationFieldInfo);n=(0,A.fk)(n,i,r,s)}return n}getExpressionValue(e,t,i){const s={attributes:this.featureAdapter.getAttributes(e)},n=i.createExecContext(s,t.viewInfo);return i.executeFunction(t.compiledFunc,n)}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:v(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:v(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){const t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);const i={};for(const s of t){const{alias:t,clause:n}=this._fieldDataCache.get(s);i[t]=n?n.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return i}_processAttributesForDistinctValues(e){if((0,r.Wi)(e)||!this.returnDistinctValues)return e;const t=this.outFields,i=[];if(t)for(const s of t){const{alias:t}=this._fieldDataCache.get(s);i.push(e[t])}else for(const t in e)i.push(e[t]);const s=`${(t||["*"]).join(",")}=${i.join(",")}`;let n=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++n),n>1?null:e}}var M=i(53316),E=i(34398),N=i(17095),D=i(30879);class P{constructor(e,t,i){this.items=e,this.queryGeometry=t,this.definitionExpression=i.definitionExpression,this.geometryType=i.geometryType,this.hasM=i.hasM,this.hasZ=i.hasZ,this.objectIdField=i.objectIdField,this.spatialReference=i.spatialReference,this.fieldsIndex=i.fieldsIndex,this.timeInfo=i.timeInfo,this.featureAdapter=i.featureAdapter,this.aggregateAdapter=i.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(e){const t=new Q(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:s}=e;if(!(null==i?void 0:i.length))return 1;const n=new Map,r=new Map,a=new Set,l=e.outStatistics;for(const e of l){const{statisticType:l}=e,o="exceedslimit"!==l?e.onStatisticField:void 0;if(!r.has(o)){const e=[];for(const s of i){const i=this._getAttributeValues(t,s,n);e.push(i)}r.set(o,this._calculateUniqueValues(e,t.returnDistinctValues))}const u=r.get(o);for(const e in u){const{data:i,items:n}=u[e],r=i.join(",");s&&!t.validateItems(n,s)||a.add(r)}}return a.size}createQueryResponse(e){let t;return t=e.outStatistics?e.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&((0,f.JY)(e.outSR)&&!(0,f.fS)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=(0,E.S2)({spatialReference:e.outSR,...(0,V.iV)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR)}):t.queryGeometry=(0,E.S2)({spatialReference:e.outSR,...this.queryGeometry})),t}createSnappingResponse(e,t){const i=this.featureAdapter,s=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),{x:n,y:a}=e.point,l="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},c="esriGeometryPolygon"===this.geometryType,h=this.getPointCreator(e.point,this.spatialReference,t);for(const t of this.items){const d=i.getGeometry(t);if((0,r.Wi)(d))continue;const{coords:f,lengths:p}=d;if(1&e.types){let e=0;for(let r=0;r<p.length;r++){const c=p[r];for(let r=0;r<c;r++,e+=s){const d=f[e],p=f[e+1];if(r!==c-1){const r=f[e+s],c=f[e+s+1],{x:m,y}=G(n,a,d,p,r,c),g=(n-m)/l,x=(a-y)/o,S=g*g+x*x;S<=1&&u.candidates.push({type:"edge",objectId:i.getObjectId(t),distance:Math.sqrt(S),target:h(m,y),start:h(d,p),end:h(r,c)})}}}}if(2&e.types){const e=c?f.length-s:f.length;for(let r=0;r<e;r+=s){const e=f[r],s=f[r+1],c=(n-e)/l,d=(a-s)/o,p=c*c+d*d;p<=1&&u.candidates.push({type:"vertex",objectId:i.getObjectId(t),distance:Math.sqrt(p),target:h(e,s)})}}}return u.candidates.sort(((e,t)=>e.distance-t.distance)),u}getPointCreator(e,t,i){const s=(0,r.pC)(i)&&!(0,f.fS)(t,i)?e=>(0,V.iV)(e,t,i):e=>e;return null!=e.z&&null!=e.m?(t,i)=>s({x:t,y:i,z:e.z,m:e.m}):null!=e.z?(t,i)=>s({x:t,y:i,z:e.z}):null!=e.m?(t,i)=>s({x:t,y:i,m:e.m}):(e,t)=>s({x:e,y:t})}executeAttributesQuery(e){const t=v(e.where,this.fieldsIndex);if(!t)return Promise.resolve(this);if(t.isStandardized){let i=0;const s=[];for(const e of this.items)t.testFeature(e,this.featureAdapter)&&(s[i++]=e);const n=new P(s,this.queryGeometry,this);return n.definitionExpression=e.where,Promise.resolve(n)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(e){if(!e.aggregateIds||!e.aggregateIds.length||(0,r.Wi)(this.aggregateAdapter))return Promise.resolve(this);const t=new Set;for(const i of e.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(i).forEach((e=>t.add(e)));const i=this.featureAdapter.getObjectId;return Promise.resolve(new P(this.items.filter((e=>t.has(i(e)))),this.queryGeometry,this))}executeObjectIdsQuery(e){if(!e.objectIds||!e.objectIds.length)return Promise.resolve(this);const t=new Set(e.objectIds),i=this.featureAdapter.getObjectId;return Promise.resolve(new P(this.items.filter((e=>t.has(i(e)))),this.queryGeometry,this))}executeTimeQuery(e){const t=(0,M.y)(this.timeInfo,e.timeExtent,this.featureAdapter);if(!(0,r.pC)(t))return Promise.resolve(this);const i=this.items.filter(t);return Promise.resolve(new P(i,this.queryGeometry,this))}filterLatest(){const{trackIdField:e,startTimeField:t,endTimeField:i}=this.timeInfo,s=i||t,n=new Map,r=this.featureAdapter.getAttribute;for(const t of this.items){const i=r(t,e),a=r(t,s),l=n.get(i);(!l||a>r(l,s))&&n.set(i,t)}const a=Array.from(n.values());return Promise.resolve(new P(a,this.queryGeometry,this))}async project(e){if(!e||(0,f.fS)(this.spatialReference,e))return this;const t=this.featureAdapter,i=(await(0,V.oj)(this.items.map((e=>(0,E.Op)(this.geometryType,this.hasZ,this.hasM,t.getGeometry(e)))),this.spatialReference,e)).map(((e,i)=>t.cloneWithGeometry(this.items[i],(0,z.GH)(e,this.hasZ,this.hasM))));return new P(i,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:e,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})}async createSummaryStatisticsResponse(e,t){const{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,minValue:l,maxValue:o,scale:u}=t,c=this.fieldsIndex.isDateField(i),h=await this._getDataValues(e,{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,scale:u}),d=(0,A.S5)({normalizationType:r,normalizationField:n,minValue:l,maxValue:o}),f=this.fieldsIndex.get(i),p={value:.5,fieldType:null==f?void 0:f.type},m=(0,N.qN)(f)?(0,A.H0)({values:h,supportsNullCount:d,percentileParams:p}):(0,A.i5)({values:h,minValue:l,maxValue:o,useSampleStdDev:!r,supportsNullCount:d,percentileParams:p});return(0,A.F_)(m,c)}async createUniqueValuesResponse(e,t){const{field:i,valueExpression:s,domain:n,returnAllCodedValues:r,scale:a}=t,l=await this._getDataValues(e,{field:i,valueExpression:s,scale:a}),o=(0,A.eT)(l);return(0,A.Qm)(o,n,r)}async createClassBreaksResponse(e,t){const{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:o,minValue:u,maxValue:c,numClasses:h,scale:d}=t,f=await this._getDataValues(e,{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,scale:d}),p=(0,A.G2)(f,{field:i,normalizationField:n,normalizationType:r,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:o,minValue:u,maxValue:c,numClasses:h});return(0,A.DL)(p,l)}async createHistogramResponse(e,t){const{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:o,minValue:u,maxValue:c,numBins:h,scale:d}=t,f=await this._getDataValues(e,{field:i,valueExpression:s,normalizationField:n,normalizationType:r,normalizationTotal:a,scale:d});return(0,A.oF)(f,{field:i,normalizationField:n,normalizationType:r,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:o,minValue:u,maxValue:c,numBins:h})}_sortFeatures(e,t,i){if(e.length>1&&t&&t.length)for(const s of t.reverse()){const t=s.split(" "),n=t[0],r=this.fieldsIndex.get(n),a=t[1]&&"desc"===t[1].toLowerCase(),l=(0,A.Lq)(null==r?void 0:r.type,a);e.sort(((e,t)=>{const s=i(e,n,r),a=i(t,n,r);return l(s,a)}))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:i,hasM:s,hasZ:n,objectIdField:r,spatialReference:a}=this,{outFields:l,outSR:o,quantizationParameters:u,resultRecordCount:c,resultOffset:h,returnZ:d,returnM:f}=e,p=null!=c&&t.length>(h||0)+c,m=l&&(l.includes("*")?[...this.fieldsIndex.fields]:l.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:p,features:this._createFeatures(e,t),fields:m,geometryType:i,hasM:s&&f,hasZ:n&&d,objectIdFieldName:r,spatialReference:(0,E.S2)(o||a),transform:u&&(0,C.vY)(u)||null}}_createFeatures(e,t){const i=new Q(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:n}=this,{orderByFields:r,quantizationParameters:a,returnGeometry:l,returnCentroid:o,maxAllowableOffset:u,resultOffset:c,resultRecordCount:h,returnZ:d=!1,returnM:f=!1}=e,p=n&&d,m=s&&f;let y=[],g=0;const x=[...t];if(this._sortFeatures(x,r,((e,t,s)=>i.getFieldValue(e,t,s))),l||o){const e=(0,C.vY)(a);if(l&&!o)for(const t of x)y[g++]={attributes:i.getAttributes(t),geometry:(0,E.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),u,e,p,m)};else if(!l&&o)for(const t of x)y[g++]={attributes:i.getAttributes(t),centroid:(0,E.EG)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of x)y[g++]={attributes:i.getAttributes(t),centroid:(0,E.EG)(this,this.featureAdapter.getCentroid(t,this),e),geometry:(0,E.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),u,e,p,m)}}else for(const e of x){const t=i.getAttributes(e);t&&(y[g++]={attributes:t})}const S=c||0;if(null!=h){const e=S+h;y=y.slice(S,Math.min(y.length,e))}return y}_createExceedsLimitQueryResponse(e){let t=!1,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const t of e.outStatistics)if("exceedslimit"===t.statisticType){i=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,s=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>i;else if(this.items.length>s)t=!0;else{const e=this.hasZ?this.hasM?4:3:this.hasM?3:2,i=this.featureAdapter;t=this.items.reduce(((e,t)=>{const s=i.getGeometry(t);return e+((0,r.pC)(s)&&s.coords.length||0)}),0)/e>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){const t={attributes:{}},i=[],s=new Map,n=new Map,r=new Map,a=new Map,l=new Q(e,this.featureAdapter,this.fieldsIndex),o=e.outStatistics,{groupByFieldsForStatistics:u,having:c,orderByFields:h}=e,d=u&&u.length,f=!!d,p=f&&u[0],m=f&&!this.fieldsIndex.get(p);for(const e of o){const{outStatisticFieldName:o,statisticType:h}=e,y=e,g="exceedslimit"!==h?e.onStatisticField:void 0,x="percentile_disc"===h||"percentile_cont"===h,S=f&&1===d&&(g===p||m)&&"count"===h;if(f){if(!r.has(g)){const e=[];for(const t of u){const i=this._getAttributeValues(l,t,s);e.push(i)}r.set(g,this._calculateUniqueValues(e,l.returnDistinctValues))}const e=r.get(g);for(const t in e){const{count:i,data:n,items:r,itemPositions:h}=e[t],d=n.join(",");if(!c||l.validateItems(r,c)){const e=a.get(d)||{attributes:{}};let t=null;if(S)t=i;else{const e=this._getAttributeValues(l,g,s),i=h.map((t=>e[t]));t=x&&"statisticParameters"in y?this._getPercentileValue(y,i):this._getStatisticValue(y,i,null,l.returnDistinctValues)}e.attributes[o]=t,u.forEach(((t,i)=>e.attributes[this.fieldsIndex.get(t)?t:`EXPR_${i+1}`]=n[i])),a.set(d,e)}}}else{const e=this._getAttributeValues(l,g,s);t.attributes[o]=x&&"statisticParameters"in y?this._getPercentileValue(y,e):this._getStatisticValue(y,e,n,l.returnDistinctValues)}i.push({name:o,alias:o,type:"esriFieldTypeDouble"})}const y=f?Array.from(a.values()):[t];return this._sortFeatures(y,h,((e,t)=>e.attributes[t])),{fields:i,features:y}}_getStatisticValue(e,t,i,s){const{onStatisticField:n,statisticType:r}=e;let a=null;return a=null!=i&&i.has(n)?i.get(n):(0,N.qN)(this.fieldsIndex.get(n))?(0,A.H0)({values:t,returnDistinct:s}):(0,A.i5)({values:t,minValue:null,maxValue:null,useSampleStdDev:!0}),i&&i.set(n,a),a["var"===r?"variance":r]}_getPercentileValue(e,t){const{onStatisticField:i,statisticParameters:s,statisticType:n}=e,{value:r,orderBy:a}=s,l=this.fieldsIndex.get(i),o={value:r,orderBy:a,fieldType:null==l?void 0:l.type,isDiscrete:"percentile_disc"===n};return(0,A.XL)(t,o)}_getAttributeValues(e,t,i){if(i.has(t))return i.get(t);const s=this.fieldsIndex.get(t),n=this.items.map((i=>e.getFieldValue(i,t,s)));return i.set(t,n),n}_getAttributeNormalizedValues(e,t){return this.items.map((i=>e.getNormalizedValue(i,{field:t.field,fieldInfo:this.fieldsIndex.get(t.field),normalizationField:t.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(t.normalizationField),normalizationType:t.normalizationType,normalizationTotal:t.normalizationTotal})))}async _getAttributeExpressionValues(e,t,i){const{arcadeUtils:s}=await(0,D.LC)(),n=s.createFunction(t),r=i&&s.getViewInfo(i);return this.items.map((t=>e.getExpressionValue(t,{compiledFunc:n,viewInfo:r},s)))}_calculateUniqueValues(e,t){const i={},s=this.items,n=s.length;for(let r=0;r<n;r++){const n=s[r],a=[];for(const t of e)a.push(t[r]);const l=a.join(",");t?null==i[l]&&(i[l]={count:1,data:a,items:[n],itemPositions:[r]}):null==i[l]?i[l]={count:1,data:a,items:[n],itemPositions:[r]}:(i[l].count++,i[l].items.push(n),i[l].itemPositions.push(r))}return i}async _getDataValues(e,t){const i=new Q(e,this.featureAdapter,this.fieldsIndex),{valueExpression:s,field:n,normalizationField:r,normalizationType:a,normalizationTotal:l,scale:o}=t,u=s?{viewingMode:"map",scale:o,spatialReference:e.outSR||this.spatialReference}:null;return s?this._getAttributeExpressionValues(i,s,u):this._getAttributeNormalizedValues(i,{field:n,normalizationField:r,normalizationType:a,normalizationTotal:l})}}function G(e,t,i,s,n,r){const a=n-i,l=r-s,o=a*a+l*l,u=(e-i)*a+(t-s)*l,c=Math.min(1,Math.max(0,u/o));return{x:i+a*c,y:s+l*c}}var q=i(20592),k=i(28790),O=i(75540);const j="feature-store:unsupported-query",Z=new Set,B=new a.WJ(2e6);let U=0;class L{constructor(e){this.capabilities={query:T.g},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new a.Xq(U+++"$$",B)),this.fieldsIndex=new k.Z(e.fields),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,r.hw)(this._frameTask),this.clearCache(),(0,r.SC)(this._geometryQueryCache),this._changeHandle=(0,r.hw)(this._changeHandle),(0,r.SC)(this.fieldsIndex)}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,E.S2)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,M.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}async executeQuery(e={},t){let i,s=(0,n.d9)(e);try{s=await this._schedule((()=>(0,E.Up)(s,this.definitionExpression,this.spatialReference)),t),s=await this._reschedule((()=>this._checkQuerySupport(s)),t),i=await this._reschedule((()=>this._executeGeometryQuery(s,t)),t),i=await this._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=await this._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=await this._reschedule((()=>i.executeTimeQuery(s)),t),i=await this._reschedule((()=>i.executeAttributesQuery(s)),t)}catch(e){if(e!==E.vF)throw e;i=new P([],null,this)}return i.createQueryResponse(s)}async executeQueryForCount(e={},t){let i=(0,n.d9)(e);i.returnGeometry=!1,i.returnCentroid=!1,i.outSR=null;try{i=await this._schedule((()=>(0,E.Up)(i,this.definitionExpression,this.spatialReference)),t),i=await this._reschedule((()=>this._checkQuerySupport(i)),t);let e=await this._reschedule((()=>this._executeGeometryQuery(i,t)),t);return e=await this._reschedule((()=>e.executeAggregateIdsQuery(i)),t),e=await this._reschedule((()=>e.executeObjectIdsQuery(i)),t),e=await this._reschedule((()=>e.executeTimeQuery(i)),t),e=await this._reschedule((()=>e.executeAttributesQuery(i)),t),e.createQueryResponseForCount(i)}catch(e){if(e!==E.vF)throw e;return 0}}async executeQueryForExtent(e={},t){let i,s=(0,n.d9)(e);const r=s.outSR;try{s=await this._schedule((()=>(0,E.Up)(s,this.definitionExpression,this.spatialReference)),t),s=await this._reschedule((()=>this._checkQuerySupport(s)),t),s.returnGeometry=!0,s.returnCentroid=!1,s.outSR=null,i=await this._reschedule((()=>this._executeGeometryQuery(s,t)),t),i=await this._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=await this._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=await this._reschedule((()=>i.executeTimeQuery(s)),t),i=await this._reschedule((()=>i.executeAttributesQuery(s)),t);const e=i.size;if(!e)return{count:e,extent:null};(0,o.t8)(Y,o.Gv),this.featureStore.forEachBounds(i.items,(e=>(0,o.TC)(Y,e)),W);const n={xmin:Y[0],ymin:Y[1],xmax:Y[3],ymax:Y[4],spatialReference:(0,E.S2)(this.spatialReference)};this.hasZ&&isFinite(Y[2])&&isFinite(Y[5])&&(n.zmin=Y[2],n.zmax=Y[5]);const a=(0,V.iV)(n,i.spatialReference,r);if(a.spatialReference=(0,E.S2)(r||this.spatialReference),a.xmax-a.xmin==0){const e=(0,l.c9)(a.spatialReference);a.xmin-=e,a.xmax+=e}if(a.ymax-a.ymin==0){const e=(0,l.c9)(a.spatialReference);a.ymin-=e,a.ymax+=e}if(this.hasZ&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin==0){const e=(0,l.c9)(a.spatialReference);a.zmin-=e,a.zmax+=e}return{count:e,extent:a}}catch(e){if(e===E.vF)return{count:0,extent:null};throw e}}async executeQueryForIds(e={},t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e={},t){let i,s=(0,n.d9)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=await this._schedule((()=>(0,E.Up)(s,this.definitionExpression,this.spatialReference)),t),s=await this._reschedule((()=>this._checkQuerySupport(s)),t),i=await this._reschedule((()=>this._executeGeometryQuery(s,t)),t),i=await this._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=await this._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=await this._reschedule((()=>i.executeTimeQuery(s)),t),i=await this._reschedule((()=>i.executeAttributesQuery(s)),t);const e=i.items,n=new Set;return await this._reschedule((()=>{for(const t of e)n.add(i.featureAdapter.getObjectId(t))}),t),n}catch(e){if(e===E.vF)return new Set;throw e}}async executeQueryForSnapping(e,t){const{point:i,distance:s,types:n}=e;if(0===n)return{candidates:[]};const a=await this._reschedule((()=>this._checkQuerySupport(e.query)),t),l=!(0,f.fS)(i.spatialReference,this.spatialReference);l&&await(0,V._W)(i.spatialReference,this.spatialReference);const o="number"==typeof s?s:s.x,u="number"==typeof s?s:s.y,c={xmin:i.x-o,xmax:i.x+o,ymin:i.y-u,ymax:i.y+u,spatialReference:i.spatialReference},p=l?(0,V.iV)(c,this.spatialReference):c;if(!p)return{candidates:[]};const m=(await(0,d.aX)((0,h.im)(i),null,{signal:t}))[0],y=(await(0,d.aX)((0,h.im)(p),null,{signal:t}))[0];if((0,r.Wi)(m)||(0,r.Wi)(y))return{candidates:[]};let g=new P(this._searchFeatures(this._getQueryBBoxes(y.toJSON())),null,this);g=await this._reschedule((()=>g.executeObjectIdsQuery(a)),t),g=await this._reschedule((()=>g.executeTimeQuery(a)),t),g=await this._reschedule((()=>g.executeAttributesQuery(a)),t);const x=m.toJSON(),S=l?(0,V.iV)(x,this.spatialReference):x,_=l?Math.max(p.xmax-p.xmin,p.ymax-p.ymin)/2:s;return g.createSnappingResponse({...e,point:S,distance:_},i.spatialReference)}async executeQueryForLatestObservations(e={},t){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new s.Z(j,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});let i,r=(0,n.d9)(e);try{r=await this._schedule((()=>(0,E.Up)(r,this.definitionExpression,this.spatialReference)),t),r=await this._reschedule((()=>this._checkQuerySupport(r)),t),i=await this._reschedule((()=>this._executeGeometryQuery(r,t)),t),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),t),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),t),i=await this._reschedule((()=>i.executeTimeQuery(r)),t),i=await this._reschedule((()=>i.executeAttributesQuery(r)),t),i=await this._reschedule((()=>i.filterLatest()),t)}catch(e){if(e!==E.vF)throw e;i=new P([],null,this)}return i.createQueryResponse(r)}async executeQueryForSummaryStatistics(e={},t,i){const{field:s,normalizationField:n,valueExpression:r}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:n,valueExpression:r},i)).createSummaryStatisticsResponse(e,t)}async executeQueryForUniqueValues(e={},t,i){const{field:s,valueExpression:n}=t;return(await this._getQueryEngineResultForStats(e,{field:s,valueExpression:n},i)).createUniqueValuesResponse(e,t)}async executeQueryForClassBreaks(e={},t,i){const{field:s,normalizationField:n,valueExpression:r}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:n,valueExpression:r},i)).createClassBreaksResponse(e,t)}async executeQueryForHistogram(e={},t,i){const{field:s,normalizationField:n,valueExpression:r}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:n,valueExpression:r},i)).createHistogramResponse(e,t)}async _schedule(e,t){return(0,r.pC)(this._frameTask)?this._frameTask.schedule(e,t):e(O.G5)}async _reschedule(e,t){return(0,r.pC)(this._frameTask)?this._frameTask.reschedule(e,t):e(O.G5)}_getAll(){if(!this._allItems){const e=[];this.featureStore.forEach((t=>e.push(t))),this._allItems=new P(e,null,this)}return this._allItems}async _executeGeometryQuery(e,t){const{geometry:i,outSR:s,spatialRel:n,returnGeometry:a,returnCentroid:l}=e,o=a||l,u=(0,f.JY)(s)&&!(0,f.fS)(this.spatialReference,s),c=this._geometryQueryCache?u&&o?JSON.stringify({geometry:i,spatialRelationship:n,outSpatialReference:s}):JSON.stringify({geometry:i,spatialRelationship:n}):null;if(c){const e=this._geometryQueryCache.get(c);if(!(0,r.o8)(e))return e}const h=async e=>{if(u&&o){const t=await e.project(s);return c&&this._geometryQueryCache.put(c,t,t.size||1),t}return c&&this._geometryQueryCache.put(c,e,e.size||1),e};if(!i)return h(this._getAll());const d=this.featureAdapter;if("esriSpatialRelDisjoint"===n){const e=this._searchFeatures(this._getQueryBBoxes(i));if(!e.length)return h(this._getAll());let s,r;const a=new Set;for(const t of e)a.add(d.getObjectId(t));await this._reschedule((()=>{let e=0;s=new Array(a.size),this.featureStore.forEach((t=>s[e++]=t)),r=a}),t);const l=await this._reschedule((async()=>{const e=await(0,q.cW)(n,i,this.geometryType,this.hasZ,this.hasM);return new P(await this._runSpatialFilter(s,(t=>!r.has(d.getObjectId(t))||e(d.getGeometry(t))),t),i,this)}),t);return h(l)}const p=this._searchFeatures(this._getQueryBBoxes(i));if(!p.length){const e=new P([],i,this);return c&&this._geometryQueryCache.put(c,e,e.size||1),e}if(this._canExecuteSoloPass(i,e))return h(new P(p,i,this));const m=await(0,q.cW)(n,i,this.geometryType,this.hasZ,this.hasM),y=await this._runSpatialFilter(p,(e=>m(d.getGeometry(e))),t);return h(new P(y,i,this))}async _runSpatialFilter(e,t,i){if(!t)return e;if((0,r.Wi)(this._frameTask))return e.filter((e=>t(e)));let s=0;const n=new Array,a=async r=>{for(;s<e.length;){const l=e[s++];t(l)&&(n.push(l),r.madeProgress()),r.done&&await this._reschedule((e=>a(e)),i)}};return this._reschedule((e=>a(e)),i).then((()=>n))}_canExecuteSoloPass(e,t){const{geometryType:i}=this,{spatialRel:s}=t;return(0,q.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===s||"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s||"esriSpatialRelWithin"===s))}_getQueryBBoxes(e){if((0,q.hN)(e)){if((0,h.YX)(e))return[(0,u.al)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,h.oU)(e))return e.rings.map((e=>(0,u.al)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[(0,c.$P)((0,u.Ue)(),e)]}_searchFeatures(e){for(const t of e)this.featureStore.forEachInBounds(t,(e=>{Z.add(e)}));const t=new Array(Z.size);let i=0;return Z.forEach((e=>t[i++]=e)),Z.clear(),t}async _checkStatisticsSupport(e,t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new s.Z(j,"Unsupported query options",{query:e});return Promise.all([this._checkAttributesQuerySupport(e),this._checkStatisticsParamsSupport(t),(0,q.P0)(e,this.geometryType,this.spatialReference),(0,V._W)(this.spatialReference,e.outSR)]).then((()=>e))}async _checkStatisticsParamsSupport(e){let t=[];if(e.valueExpression){const{arcadeUtils:i}=await(0,D.LC)();t=i.extractFieldNames(e.valueExpression)}if(e.field&&t.push(e.field),e.normalizationField&&t.push(e.normalizationField),!t.length)throw new s.Z(j,"params should have at least a field or valueExpression",{params:e});F(this.fieldsIndex,t,"params contains missing fields")}async _checkQuerySupport(e){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new s.Z(j,"Unsupported query options",{query:e});return Promise.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),(0,q.P0)(e,this.geometryType,this.spatialReference),(0,V._W)(this.spatialReference,e.outSR)]).then((()=>e))}_checkAttributesQuerySupport(e){const{outFields:t,orderByFields:i,returnDistinctValues:n,outStatistics:r}=e,a=r?r.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())):[];if(i&&i.length>0){const e=" asc",t=" desc",s=i.map((i=>{const s=i.toLowerCase();return s.indexOf(e)>-1?s.split(e)[0]:s.indexOf(t)>-1?s.split(t)[0]:i})).filter((e=>-1===a.indexOf(e)));F(this.fieldsIndex,s,"orderByFields contains missing fields")}if(t&&t.length>0)F(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new s.Z(j,"outFields should be specified for returnDistinctValues",{query:e});_(this.fieldsIndex,e.where)}async _checkStatisticsQuerySupport(e){const{outStatistics:t,groupByFieldsForStatistics:i,having:n}=e,r=i&&i.length,a=t&&t.length;if(n){if(!r||!a)throw new s.Z(j,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});w(this.fieldsIndex,n,t)}if(a){if(!t.every((e=>"exceedslimit"!==e.statisticType)))return;const n=t.map((e=>e.onStatisticField));F(this.fieldsIndex,n,"onStatisticFields contains missing fields"),r&&F(this.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields");for(const i of t){const{onStatisticField:t,statisticType:n}=i;if("percentile_disc"!==n&&"percentile_cont"!==n||!("statisticParameters"in i)){if("count"!==n&&t&&R(t,this.fieldsIndex))throw new s.Z(j,"outStatistics contains non-numeric fields",{definition:i,query:e})}else{const{statisticParameters:t}=i;if(!t)throw new s.Z(j,"statisticParamters should be set for percentile type",{definition:i,query:e})}}}}async _getQueryEngineResultForStats(e={},t,i){let s;e=(0,n.d9)(e);try{e=await this._schedule((()=>(0,E.Up)(e,this.definitionExpression,this.spatialReference)),i),e=await this._reschedule((()=>this._checkStatisticsSupport(e,t)),i),s=await this._reschedule((()=>this._executeGeometryQuery(e,i)),i),s=await this._reschedule((()=>s.executeAggregateIdsQuery(e)),i),s=await this._reschedule((()=>s.executeObjectIdsQuery(e)),i),s=await this._reschedule((()=>s.executeTimeQuery(e)),i),s=await this._reschedule((()=>s.executeAttributesQuery(e)),i)}catch(e){if(e!==E.vF)throw e;s=new P([],null,this)}return s}}const W=(0,o.Ue)(),Y=(0,o.Ue)()},10287:(e,t,i)=>{i.d(t,{g:()=>s});const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},20592:(e,t,i)=>{i.d(t,{hN:()=>F,P0:()=>v,cW:()=>w});var s=i(70375),n=i(27127),r=i(68668),a=i(53736),l=i(35925);function o(e,t){return e?t?4:3:t?3:2}function u(e,t,i,s,n,r){const a=o(n,r),{coords:l,lengths:u}=s;if(!u)return!1;for(let s=0,n=0;s<u.length;s++,n+=a)if(!c(e,t,i,l[n],l[n+1]))return!1;return!0}function c(e,t,i,s,n){if(!e)return!1;const r=o(t,i),{coords:a,lengths:l}=e;let u=!1,c=0;for(const e of l)u=h(u,a,r,c,e,s,n),c+=e*r;return u}function h(e,t,i,s,n,r,a){let l=e,o=s;for(let e=s,u=s+n*i;e<u;e+=i){o=e+i,o===u&&(o=s);const n=t[e],c=t[e+1],h=t[o],d=t[o+1];(c<a&&d>=a||d<a&&c>=a)&&n+(a-c)/(d-c)*(h-n)<r&&(l=!l)}return l}var d=i(12065),f=i(15540),p=i(66069),m=i(34398);const y="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},x={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function w(e,t,s,l,o){if((0,a.oU)(t)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,d.Uy)(new f.Z,t,!1,!1);return Promise.resolve((t=>function(e,t,i,s){return c(e,!1,!1,s.coords[0],s.coords[1])}(e,0,0,t)))}if((0,a.oU)(t)&&"esriGeometryMultipoint"===s){const i=(0,d.Uy)(new f.Z,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>u(i,!1,!1,e,l,o)))}if((0,a.YX)(t)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,n.aV)(t,(0,m.Op)(s,l,o,e))));if((0,a.YX)(t)&&"esriGeometryMultipoint"===s&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,n.lQ)(t,(0,m.Op)(s,l,o,e))));if((0,a.YX)(t)&&"esriSpatialRelIntersects"===e){const e=function(e){return"mesh"===e?r.h_:(0,r.IY)(e)}(s);return Promise.resolve((i=>e(t,(0,m.Op)(s,l,o,i))))}return i.e(8923).then(i.bind(i,8923)).then((i=>{const n=i[g[e]].bind(null,t.spatialReference,t);return e=>n((0,m.Op)(s,l,o,e))}))}async function v(e,t,i){const{spatialRel:n,geometry:r}=e;if(r){if(!function(e){return!0===x[e]}(n))throw new s.Z(y,"Unsupported query spatial relationship",{query:e});if((0,l.JY)(r.spatialReference)&&(0,l.JY)(i)){if(!function(e){return!0===S[(0,a.Ji)(e)]}(r))throw new s.Z(y,"Unsupported query geometry type",{query:e});if(!function(e){return!0===_[e]}(t))throw new s.Z(y,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,p._W)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function F(e){if((0,a.YX)(e))return!0;if((0,a.oU)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},53316:(e,t,i)=>{function s(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:s,endTimeField:n}=e;let r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&n)t.forEach((e=>{const t=i.getAttribute(e,s),l=i.getAttribute(e,n);null==t||isNaN(t)||(r=Math.min(r,t)),null==l||isNaN(l)||(a=Math.max(a,l))}));else{const e=s||n;t.forEach((t=>{const s=i.getAttribute(t,e);null==s||isNaN(s)||(r=Math.min(r,s),a=Math.max(a,s))}))}return{start:r,end:a}}function n(e,t,i){if(!t||!e)return null;const{startTimeField:s,endTimeField:n}=e;if(!s&&!n)return null;const{start:r,end:a}=t;return null===r&&null===a?null:void 0===r&&void 0===a?()=>!1:s&&n?function(e,t,i,s,n){return null!=s&&null!=n?r=>{const a=e.getAttribute(r,t),l=e.getAttribute(r,i);return(null==a||a<=n)&&(null==l||l>=s)}:null!=s?t=>{const n=e.getAttribute(t,i);return null==n||n>=s}:null!=n?i=>{const s=e.getAttribute(i,t);return null==s||s<=n}:void 0}(i,s,n,r,a):function(e,t,i,s){return null!=i&&null!=s&&i===s?s=>e.getAttribute(s,t)===i:null!=i&&null!=s?n=>{const r=e.getAttribute(n,t);return r>=i&&r<=s}:null!=i?s=>e.getAttribute(s,t)>=i:null!=s?i=>e.getAttribute(i,t)<=s:void 0}(i,s||n,r,a)}i.d(t,{R:()=>s,y:()=>n})},34398:(e,t,i)=>{i.d(t,{vF:()=>p,S2:()=>F,Op:()=>_,Up:()=>w,j6:()=>v,EG:()=>S});var s=i(25709),n=i(61681),r=i(17321),a=i(50842),l=i(53736),o=i(56247),u=i(35925),c=i(12065),h=i(15540),d=i(66069);const f=new s.Xn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({}),m=new h.Z,y=new h.Z,g=new h.Z,x={esriGeometryPoint:c.fQ,esriGeometryPolyline:c.J6,esriGeometryPolygon:c.eG,esriGeometryMultipoint:c.Iv};function S(e,t,i,s=e.hasZ,r=e.hasM){if((0,n.Wi)(t))return null;const a=e.hasZ&&s,l=e.hasM&&r;if(i){const n=(0,c.Nh)(g,t,e.hasZ,e.hasM,"esriGeometryPoint",i,s,r);return(0,c.fQ)(n,a,l)}return(0,c.fQ)(t,a,l)}function _(e,t,i,s,r,a,l=t,o=i){const u=t&&l,h=i&&o,d=(0,n.pC)(s)?"coords"in s?s:s.geometry:null;if((0,n.Wi)(d))return null;if(r){let s=(0,c.zj)(y,d,t,i,e,r,l,o);return a&&(s=(0,c.Nh)(g,s,u,h,e,a)),x[e](s,u,h)}if(a){const s=(0,c.Nh)(g,d,t,i,e,a,l,o);return x[e](s,u,h)}return(0,c.hY)(m,d,t,i,l,o),x[e](m,u,h)}async function w(e,t,i){const{outFields:s,orderByFields:n,groupByFieldsForStatistics:r,outStatistics:a}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(r)for(let e=0;e<r.length;e++)r[e]=r[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),v(e,t,i)}async function v(e,t,s){if(!e)return null;let{where:c}=e;if(e.where=c=c&&c.trim(),(!c||/^1 *= *1$/.test(c)||t&&t===c)&&(e.where=null),!e.geometry)return e;let h=await async function(e){const{geometry:t,distance:s,units:n}=e;if(null==s||"vertexAttributes"in t)return t;const a=t.spatialReference,l=n?f.fromJSON(n):(0,r.qE)(a),o=a&&((0,u.sT)(a)||(0,u.sS)(a))?t:await(0,d._W)(a,u.Zn).then((()=>(0,d.iV)(t,u.Zn)));return(await async function(){return(await i.e(8923).then(i.bind(i,8923))).geodesicBuffer}())(o.spatialReference,o,s,l)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;h=(0,a.aO)(h),h.spatialReference=t}e.geometry=h,await(0,d._W)(h.spatialReference,s);const m=(await(0,o.aX)((0,l.im)(h)))[0];if((0,n.Wi)(m))throw p;const y=m.toJSON(),g=await(0,d.iV)(y,y.spatialReference,s);if(!g)throw p;return g.spatialReference=s,e.geometry=g,e}function F(e){return e&&b in e?JSON.parse(JSON.stringify(e,I)):e}const b="_geVersion",I=(e,t)=>e!==b?t:void 0},23230:(e,t,i)=>{i.d(t,{Z:()=>y});var s=i(36663),n=i(25709),r=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(49004),o=i(81657),u=i(18251);const c=new n.Xn({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let h=class extends l.wq{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};(0,s._)([(0,r.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"baseSymbol",void 0),(0,s._)([(0,r.Cb)({types:o.V,json:{read:{reader:o.i},write:!0}})],h.prototype,"colorRamp",void 0),(0,s._)([(0,r.Cb)({json:{read:c.read,write:c.write}})],h.prototype,"type",void 0),h=(0,s._)([(0,a.j)("esri.rest.support.ClassificationDefinition")],h);const d=h,f=new n.Xn({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),p=new n.Xn({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let m=class extends d{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,s._)([(0,r.Cb)({json:{write:!0}})],m.prototype,"breakCount",void 0),(0,s._)([(0,r.Cb)({json:{write:!0}})],m.prototype,"classificationField",void 0),(0,s._)([(0,r.Cb)({type:String,json:{read:f.read,write:f.write}})],m.prototype,"classificationMethod",void 0),(0,s._)([(0,r.Cb)({json:{write:!0}})],m.prototype,"normalizationField",void 0),(0,s._)([(0,r.Cb)({json:{read:p.read,write:p.write}})],m.prototype,"normalizationType",void 0),(0,s._)([(0,r.Cb)({value:null,json:{write:!0}})],m.prototype,"standardDeviationInterval",null),(0,s._)([(0,r.Cb)({value:null,json:{write:!0}})],m.prototype,"definedInterval",null),(0,s._)([(0,r.Cb)()],m.prototype,"type",void 0),m=(0,s._)([(0,a.j)("esri.rest.support.ClassBreaksDefinition")],m);const y=m},46479:(e,t,i)=>{i.d(t,{G2:()=>b,oF:()=>R,XL:()=>y,i5:()=>m,H0:()=>p,eT:()=>w,Qm:()=>v,Lq:()=>g,fk:()=>F,S5:()=>f,F_:()=>_,DL:()=>I});var s=i(23230);function n(e,t){return Number(e.toFixed(t))}function r(e){const t=e.definition,{classificationMethod:i,breakCount:s,normalizationType:r,definedInterval:o}=t,u=[];let c=e.values;if(0===c.length)return[];c=c.sort(((e,t)=>e-t));const h=c[0],d=c[c.length-1];if("equal-interval"===i)if(c.length>=s){const e=(d-h)/s;let t=h;for(let i=1;i<s;i++){const s=n(h+i*e,6);u.push({minValue:t,maxValue:s,label:a(t,s,r)}),t=s}u.push({minValue:t,maxValue:d,label:a(t,d,r)})}else c.forEach((e=>{u.push({minValue:e,maxValue:e,label:a(e,e,r)})}));else if("natural-breaks"===i){const t=function(e){const t=[],i=[];let s=Number.MIN_VALUE,n=1,r=-1;for(let a=0;a<e.length;a++){const l=e[a];l===s?(n++,i[r]=n):null!==l&&(t.push(l),s=l,n=1,i.push(n),r++)}return{uniqueValues:t,valueFrequency:i}}(c),i=e.valueFrequency||t.valueFrequency,o=l(t.uniqueValues,i,s);let f=h;for(let e=1;e<s;e++)if(t.uniqueValues.length>e){const i=n(t.uniqueValues[o[e]],6);u.push({minValue:f,maxValue:i,label:a(f,i,r)}),f=i}u.push({minValue:f,maxValue:d,label:a(f,d,r)})}else if("quantile"===i)if(c.length>=s&&h!==d){let e=h,t=Math.ceil(c.length/s),i=0;for(let n=1;n<s;n++){let l=t+i-1;l>c.length&&(l=c.length-1),l<0&&(l=0),u.push({minValue:e,maxValue:c[l],label:a(e,c[l],r)}),e=c[l],i+=t,t=Math.ceil((c.length-i)/(s-n))}u.push({minValue:e,maxValue:d,label:a(e,d,r)})}else{let e=-1;for(let t=0;t<c.length;t++){const i=c[t];i!==e&&(e=i,u.push({minValue:e,maxValue:i,label:a(e,i,r)}),e=i)}}else if("standard-deviation"===i){const e=function(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/=e.length,t}(c),t=function(e,t){let i=0;for(let s=0;s<e.length;s++){const n=e[s];i+=(n-t)*(n-t)}return i/=e.length,Math.sqrt(i)}(c,e);if(0===t)u.push({minValue:c[0],maxValue:c[0],label:a(c[0],c[0],r)});else{const i=function(e,t,i,s,n){let r=Math.max(s-e,t-s)/n/i;return r=r>=1?1:r>=.5?.5:.25,r}(h,d,s,e,t)*t;let l=0,o=h;for(let t=s;t>=1;t--){const s=n(e-(t-.5)*i,6);u.push({minValue:o,maxValue:s,label:a(o,s,r)}),o=s,l++}let c=n(e+.5*i,6);u.push({minValue:o,maxValue:c,label:a(o,c,r)}),o=c,l++;for(let t=1;t<=s;t++)c=l===2*s?d:n(e+(t+.5)*i,6),u.push({minValue:o,maxValue:c,label:a(o,c,r)}),o=c,l++}}else if("defined-interval"===i){if(!o)return u;const e=c[0],t=c[c.length-1],i=Math.ceil((t-e)/o);let s=e;for(let t=1;t<i;t++){const i=n(e+t*o,6);u.push({minValue:s,maxValue:i,label:a(s,i,r)}),s=i}u.push({minValue:s,maxValue:t,label:a(s,t,r)})}return u}function a(e,t,i){let s=null;return s=e===t?i&&"percent-of-total"===i?e+"%":e.toString():i&&"percent-of-total"===i?e+"% - "+t+"%":e+" - "+t,s}function l(e,t,i){const s=e.length,n=[];i>s&&(i=s);for(let e=0;e<i;e++)n.push(Math.round(e*s/i-1));n.push(s-1);let r=o(n,e,t,i);return function(e,t,i,s,n,r){let a=0,l=0,o=0,c=0,h=!0;for(let d=0;d<2&&h;d++){0===d&&(h=!1);for(let d=0;d<r-1;d++)for(;i[d+1]+1!==i[d+2];){i[d+1]=i[d+1]+1;const r=u(d,i,s,n);o=r.sbMean,a=r.sbSdcm;const f=u(d+1,i,s,n);if(c=f.sbMean,l=f.sbSdcm,!(a+l<t[d]+t[d+1])){i[d+1]=i[d+1]-1;break}t[d]=a,t[d+1]=l,e[d]=o,e[d+1]=c,h=!0}for(let d=r-1;d>0;d--)for(;i[d]!==i[d-1]+1;){i[d]=i[d]-1;const r=u(d-1,i,s,n);o=r.sbMean,a=r.sbSdcm;const f=u(d,i,s,n);if(c=f.sbMean,l=f.sbSdcm,!(a+l<t[d-1]+t[d])){i[d]=i[d]+1;break}t[d-1]=a,t[d]=l,e[d-1]=o,e[d]=c,h=!0}}return h}(r.mean,r.sdcm,n,e,t,i)&&(r=o(n,e,t,i)),n}function o(e,t,i,s){let n=[],r=[],a=[],l=0;const o=[],c=[];for(let n=0;n<s;n++){const s=u(n,e,t,i);o.push(s.sbMean),c.push(s.sbSdcm),l+=c[n]}let h,d=l,f=!0;for(;f||l<d;){f=!1,n=[];for(let t=0;t<s;t++)n.push(e[t]);for(let i=0;i<s;i++)for(let n=e[i]+1;n<=e[i+1];n++)if(h=t[n],i>0&&n!==e[i+1]&&Math.abs(h-o[i])>Math.abs(h-o[i-1]))e[i]=n;else if(i<s-1&&e[i]!==n-1&&Math.abs(h-o[i])>Math.abs(h-o[i+1])){e[i+1]=n-1;break}d=l,l=0,r=[],a=[];for(let n=0;n<s;n++){r.push(o[n]),a.push(c[n]);const s=u(n,e,t,i);o[n]=s.sbMean,c[n]=s.sbSdcm,l+=c[n]}}if(l>d){for(let t=0;t<s;t++)e[t]=n[t],o[t]=r[t],c[t]=a[t];l=d}return{mean:o,sdcm:c}}function u(e,t,i,s){let n=0,r=0;for(let a=t[e]+1;a<=t[e+1];a++){const e=s[a];n+=i[a]*e,r+=e}r<=0&&console.log("Exception in Natural Breaks calculation");const a=n/r;let l=0;for(let n=t[e]+1;n<=t[e+1];n++)l+=s[n]*(i[n]-a)**2;return{sbMean:a,sbSdcm:l}}const c=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,h=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),d=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function f(e){const t=null!=e.normalizationField||null!=e.normalizationType,i=null!=e.minValue||null!=e.maxValue,s=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!i&&!s}function p(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,i=t.filter((e=>null!=e)).length,s={count:i};return e.supportsNullCount&&(s.nullcount=t.length-i),e.percentileParams&&(s.median=y(t,e.percentileParams)),s}function m(e){const{values:t,useSampleStdDev:i,supportsNullCount:s}=e;let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=null,l=null,o=null,u=null,c=0;const h=null==e.minValue?-1/0:e.minValue,d=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=h&&e<=d&&(a+=e,n=Math.min(n,e),r=Math.max(r,e),c++):"string"==typeof e&&c++;if(c&&null!=a){l=a/c;let e=0;for(const i of t)Number.isFinite(i)&&i>=h&&i<=d&&(e+=(i-l)**2);u=i?c>1?e/(c-1):0:c>0?e/c:0,o=Math.sqrt(u)}else n=null,r=null;const f={avg:l,count:c,max:r,min:n,stddev:o,sum:a,variance:u};return s&&(f.nullcount=t.length-c),e.percentileParams&&(f.median=y(t,e.percentileParams)),f}function y(e,t){const{fieldType:i,value:s,orderBy:n,isDiscrete:r}=t,a=g(i,"desc"===n);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>a(e,t)))).length)return null;if(s<=0)return e[0];if(s>=1)return e[e.length-1];const l=(e.length-1)*s,o=Math.floor(l),u=o+1,c=l%1,h=e[o],d=e[u];return u>=e.length||r||"string"==typeof h||"string"==typeof d?h:h*(1-c)+d*c}function g(e,t){const i=t?1:-1,s=function(e){return e?(e,t)=>t-e:(e,t)=>e-t}(t),n=x(t);if(!e||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...h].includes(e))return(e,t)=>"number"==typeof e&&"number"==typeof t?s(e,t):"string"==typeof e&&"string"==typeof t?n(e,t):i;if("esriFieldTypeDate"===e)return(e,t)=>{const n=new Date(e).getTime(),r=new Date(t).getTime();return isNaN(n)||isNaN(r)?i:s(n,r)};if(h.has(e))return(e,t)=>s(e,t);if("esriFieldTypeString"===e)return(e,t)=>n(e,t);if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e){const e=x(t);return(t,i)=>e(S(t),S(i))}return t?(e,t)=>1:(e,t)=>-1}function x(e){return e?(e,t)=>(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0:(e,t)=>(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}function S(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function _(e,t){let i;for(i in e)d.indexOf(i)>-1&&(Number.isFinite(e[i])||(e[i]=null));return t?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]))})),e):e}function w(e){const t={};for(let i of e)(null==i||"string"==typeof i&&""===i.trim())&&(i=null),null==t[i]?t[i]={count:1,data:i}:t[i].count++;return{count:t}}function v(e,t,i){const s=e.count,n=[];i&&t&&"coded-value"===t.type&&t.codedValues.forEach((e=>{const t=e.code;s.hasOwnProperty(t)||(s[t]={data:t,count:0})}));for(const e in s){const t=s[e];n.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:n}}function F(e,t,i,s){let n=null;switch(t){case"log":0!==e&&(n=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(s)&&0!==s&&(n=e/s*100);break;case"field":Number.isFinite(i)&&0!==i&&(n=e/i);break;case"natural-log":e>0&&(n=Math.log(e));break;case"square-root":e>0&&(n=e**.5)}return n}function b(e,t){const i=function(e){const t=e.field,i=e.classificationMethod||"equal-interval",n=e.normalizationType,r=e.normalizationField,a=new s.Z;return a.classificationField=t,a.breakCount=e.breakCount,a.classificationMethod=i,a.standardDeviationInterval="standard-deviation"===i?e.standardDeviationInterval||1:void 0,a.normalizationType=n,a.normalizationField="field"===n?r:void 0,a}({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||5});return e=function(e,t,i){return t=null==t?-1/0:t,i=null==i?1/0:i,e.filter((e=>Number.isFinite(e)&&e>=t&&e<=i))}(e,t.minValue,t.maxValue),function(e){const{normalizationTotal:t}=e;return{classBreaks:r(e),normalizationTotal:t}}({definition:i,values:e,normalizationTotal:t.normalizationTotal})}function I(e,t){let i=e.classBreaks;const s=i.length,n=i[0].minValue,r=i[s-1].maxValue,a="standard-deviation"===t,l=c;return i=i.map((e=>{const t=e.label,i={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l).map((e=>+e.trim()));2===e.length?(i.minStdDev=e[0],i.maxStdDev=e[1],e[0]<0&&e[1]>0&&(i.hasAvg=!0)):1===e.length&&(t.includes("<")?(i.minStdDev=null,i.maxStdDev=e[0]):t.includes(">")&&(i.minStdDev=e[0],i.maxStdDev=null))}return i})),{minValue:n,maxValue:r,classBreakInfos:i,normalizationTotal:e.normalizationTotal}}function R(e,t){const{min:i,max:s,intervals:n}=function(e,t){const{field:i,classificationMethod:s,standardDeviationInterval:n,normalizationType:r,normalizationField:a,normalizationTotal:l,minValue:o,maxValue:u}=t,c=t.numBins||10;let h=null,d=null,p=null;if(s&&"equal-interval"!==s||r){const{classBreaks:t}=b(e,{field:i,normalizationType:r,normalizationField:a,normalizationTotal:l,classificationMethod:s,standardDeviationInterval:n,minValue:o,maxValue:u,numClasses:c});h=t[0].minValue,d=t[t.length-1].maxValue,p=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=o&&null!=u)h=o,d=u;else{const t=m({values:e,minValue:o,maxValue:u,useSampleStdDev:!r,supportsNullCount:f({normalizationType:r,normalizationField:a,minValue:o,maxValue:u})});h=t.min,d=t.max}p=function(e,t,i){const s=(t-e)/i,n=[];let r,a=e;for(let e=1;e<=i;e++)r=a+s,r=Number(r.toFixed(16)),n.push([a,e===i?t:r]),a=r;return n}(h,d,c)}return{min:h,max:d,intervals:p}}(e,t),r=n.map(((e,t)=>({minValue:n[t][0],maxValue:n[t][1],count:0})));for(const t of e)if(null!=t&&t>=i&&t<=s){const e=V(n,t);e>-1&&r[e].count++}return{bins:r,minValue:i,maxValue:s,normalizationTotal:t.normalizationTotal}}function V(e,t){let i=-1;for(let s=e.length-1;s>=0;s--)if(t>=e[s][0]){i=s;break}return i}}}]);
//# sourceMappingURL=1280.js.map