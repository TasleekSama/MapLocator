{"version":3,"file":"chunks/6782.js","mappings":"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","sources":["webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/engine/Bitmap.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/layers/BaseDynamicLayerView2D.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/viewStateUtils.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js","webpack://momraGisCore/./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as u}from\"../../../chunks/vec2f32.js\";import{DisplayObject as o}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import d from\"../../webgl/Texture.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function x(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function _(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new d(t,s)}class g extends o{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;i(n,n,u(o,a)),i(n,n,u(c/2,l/2)),s(n,n,-x),i(n,n,u(-c/2,-l/2)),r(n,n,u(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(x(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{g as Bitmap,c as isImageSource,x as rasterize};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Logger.js\";import{isAbortError as r}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapContainer as a}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import p from\"./support/ExportStrategy.js\";import n from\"../../layers/LayerView.js\";import{RefreshableLayerView as m}from\"../../layers/RefreshableLayerView.js\";const h=e.getLogger(\"esri.views.2d.layers.BaseDynamicLayerView2D\");let c=class extends(m(o(n))){update(t){this.strategy.update(t).catch((t=>{r(t)||h.error(t)})),this.notifyChange(\"updating\")}attach(){this._bitmapContainer=new a,this.container.addChild(this._bitmapContainer),this.strategy=new p({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this.strategy.destroy(),this.strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(t,e,r){return this.layer.fetchImage(t,e,r)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}};t([s()],c.prototype,\"strategy\",void 0),t([s()],c.prototype,\"updating\",void 0),c=t([i(\"esri.views.2d.layers.BaseDynamicLayerView2D\")],c);const d=c;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,n,o){const{resolution:r,size:u}=o;return t[0]=r*(Math.round(n[0]/r)+u[0]%2*.5),t[1]=r*(Math.round(n[1]/r)+u[1]%2*.5),t}function r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}function a(t,n){const[o,r,u,a]=t,[s,c,i,e]=n;return!(o>i||u<s||r>e||a<c)}export{a as bboxIntersects,u as getBBox,r as getOuterSize,o as snapToPixel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{debounce as i}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../../geometry/Extent.js\";import{create as a}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as p}from\"../../../../geometry/support/spatialReferenceUtils.js\";import n from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as m,getBBox as l}from\"../../viewStateUtils.js\";import{Bitmap as d}from\"../../engine/Bitmap.js\";import h from\"../../tiling/TileInfoView.js\";import c from\"../../tiling/TileKey.js\";const u=a(),g=[0,0],f=new c(0,0,0,0),x={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let y=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=x.hidpi,this.imageMaxWidth=x.imageMaxWidth,this.imageMaxHeight=x.imageMaxHeight,this.imageRotationSupported=x.imageRotationSupported,this.imageNormalizationSupported=x.imageNormalizationSupported,this.update=i((async(t,e)=>{if(!t.stationary||this.destroyed)return null;const i=t.state,o=p(i.spatialReference),r=this.hidpi?t.pixelRatio:1,s=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];s?(g[0]=i.worldScreenWidth,g[1]=i.size[1]):this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):m(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,n=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),l=!this.imageNormalizationSupported&&n,d=!a&&!l,h=this.imageRotationSupported?i.rotation:0;if(d){const t=s?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,g,t,i.resolution,h,r,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,h,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=null!=t?t:[];for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e),e.invalidateTexture(),e.requestRender()}}async _export(t,e,i,o,r,s){const a=await this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}),p=new d(a,\"additive\");return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=o,p.pixelRatio=r,p}async _singleExport(t,e,i,o,r,a,p){l(u,i,o,e);const n=new s(u[0],u[1],u[2],u[3],t.spatialReference);return[await this._export(n,e[0],e[1],r,a,p)]}_tiledExport(t,e,i,o,r){const a=n.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),p=new h(a),m=p.getTileCoverage(t);if(!m)return null;const l=[];return m.forEach(((a,n,m,d)=>{f.set(a,n,m,d),p.getTileBounds(u,f);const h=new s(u[0],u[1],u[2],u[3],t.spatialReference);l.push(this._export(h,e,e,i,o,r))})),Promise.all(l)}};t([o()],y.prototype,\"_imagePromise\",void 0),t([o()],y.prototype,\"bitmaps\",void 0),t([o()],y.prototype,\"container\",void 0),t([o()],y.prototype,\"fetchSource\",void 0),t([o()],y.prototype,\"hidpi\",void 0),t([o()],y.prototype,\"imageMaxWidth\",void 0),t([o()],y.prototype,\"imageMaxHeight\",void 0),t([o()],y.prototype,\"imageRotationSupported\",void 0),t([o()],y.prototype,\"imageNormalizationSupported\",void 0),t([o()],y.prototype,\"requestUpdate\",void 0),t([o()],y.prototype,\"updating\",null),y=t([r(\"esri.views.2d.layers.support.ExportStrategy\")],y);const S=y;export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n"],"names":["_","t","e","i","s","target","pixelFormat","internalFormat","dataType","wrapMode","width","height","g","constructor","super","this","requestRenderOnSourceChangedEnabled","_textureInvalidated","stencilRef","coordScale","_height","pixelRatio","resolution","rotation","_source","_width","x","y","blendFunction","source","requestRender","bind","destroy","_texture","dispose","isSourceScaled","sourceWidth","sourceHeight","invalidateTexture","HTMLImageElement","naturalHeight","naturalWidth","beforeRender","updateTexture","context","_createTransforms","dvs","setTransform","n","transforms","o","a","toScreenNoRotation","d","c","l","Math","PI","displayViewMat3","setSamplingProfile","mips","descriptor","hasMipmap","generateMipmap","setSamplingMode","samplingMode","bindTexture","stage","resize","getRenderedRasterPixels","setData","renderedRasterPixels","document","createElement","render","getContext","ready","onAttach","onDetach","requiresDedicatedFBO","children","some","prepareRenderPasses","registerRenderPass","name","brushes","drawPhase","pixelBlock","extent","originalPixelBlock","filter","r","getAsRGBA","createImageData","data","set","putImageData","Uint8Array","buffer","h","update","strategy","catch","error","notifyChange","attach","_bitmapContainer","container","addChild","fetchSource","fetchBitmapData","requestUpdate","detach","removeChild","removeAllChildren","moveStart","viewChange","moveEnd","layer","fetchImage","async","isUpdating","updating","updateRequested","prototype","u","abs","cos","sin","size","round","f","_imagePromise","bitmaps","hidpi","imageMaxWidth","imageMaxHeight","imageRotationSupported","imageNormalizationSupported","stationary","destroyed","state","spatialReference","worldScreenWidth","floor","xmin","valid","xmax","paddedViewState","center","_singleExport","min","_tiledExport","then","includes","fadeOut","remove","fadeIn","updateExports","visible","signal","p","ymax","_export","scales","scale","m","getTileCoverage","forEach","getTileBounds","push","Promise","all","S","initialize","handles","add","doRefresh","dataChanged","declaredClass"],"sourceRoot":""}